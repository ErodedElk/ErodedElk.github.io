<!DOCTYPE html><html lang="en" theme-mode="dark"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>2019红帽杯 - easyRE 分析与自省 | TokameinE - 雨声淅淅沥沥，犬吠永不止息</title><link rel="icon" type="image/x-icon" href="/favicon.ico"><script>var config = {"root":"/","search":{"preload":false,"activeHolder":"Enter here","blurHolder":"Search","noResult":"Data \"$0\" not found"},"code":{"codeInfo":"$0 - $1 lines","copy":"code.copy","copyFinish":"code.copyFinish","expand":"code.expand"}}</script><script src="//unpkg.com/mermaid@9.2.2/dist/mermaid.min.js"></script><link type="text/css" rel="stylesheet" href="//unpkg.com/lightgallery@2.7.1/css/lightgallery.css"><link type="text/css" rel="stylesheet" href="//unpkg.com/lightgallery@2.7.1/css/lg-zoom.css"><link type="text/css" rel="stylesheet" href="//unpkg.com/lightgallery@2.7.1/css/lg-thumbnail.css"><link type="text/css" rel="stylesheet" href="/lib/fontawesome/css/all.min.css"><link rel="stylesheet" href="/css/arknights.css"><script>if (window.localStorage.getItem('theme-mode') === 'light')
 document.documentElement.setAttribute('theme-mode', 'light')
if (window.localStorage.getItem('theme-mode') === 'dark')
 document.documentElement.setAttribute('theme-mode', 'dark')</script><style>@font-face {
 font-family: Bender;
 src: local('Bender'), url("/font/Bender.ttf"), url("/font/Bender.otf");
}
@font-face {
 font-family: BenderLight;
 src: local('BenderLight'), url("/font/BenderLight.ttf");
}
@font-face {
 font-family: 'JetBrains Mono';
 src: local('JetBrains Mono'), url('/font/JetBrainsMono-Regular.woff2') format('woff2');
}</style><style>:root {
  --dark-background: url('/img/bg.jpg');
  --light-background: url('/img/91110244_p0.jpg');
}</style><meta name="generator" content="Hexo 6.3.0"></head><body><div class="loading" style="opacity: 0;"><div class="loadingBar left"></div><div class="loadingBar right"></div></div><main><header class="closed"><div class="navBtn"><i class="navBtnIcon"><span class="navBtnIconBar"></span><span class="navBtnIconBar"></span><span class="navBtnIconBar"></span></i></div><nav><div class="navItem" id="search-header"><span class="navItemTitle"><input autocomplete="off" autocorrect="off" autocapitalize="none" placeholder="Search" spellcheck="false" maxlength="50" type="text" id="search-input"></span></div><div class="navItem" id="search-holder"></div><div class="search-popup"><div id="search-result"></div></div><ol class="navContent"><li class="navItem"><a class="navBlock" href="/"><span class="navItemTitle">Home</span></a></li><li class="navItem" matchdata="categories,tags"><a class="navBlock" href="/archives/"><span class="navItemTitle">Archives</span></a></li><li class="navItem"><a class="navBlock" href="/about/"><span class="navItemTitle">About</span></a></li><li class="navItem"><a class="navBlock" href="/links/"><span class="navItemTitle">Links</span></a></li></ol></nav></header><article><div id="post-bg"><div id="post-title"><h1>2019红帽杯 - easyRE 分析与自省</h1><div id="post-info"><span>First Post: <div class="control"><time datetime="2021-06-24T10:17:10.000Z" id="date"> 2021-06-24</time></div></span><br><span>Last Update: <div class="control"><time datetime="2024-12-29T04:50:34.974Z" id="updated"> 2024-12-29</time></div></span></div></div><hr><div id="post-content"><p>​</p>
<p>    稍微……有那么一点离谱</p>
<p>    程序无壳，可以直接放入IDA，通过字符串找到如下函数：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">__int64 sub_4009C6()<br>&#123;<br>  __int64 result; // rax<br>  int i; // [rsp+Ch] [rbp-114h]<br>  __int64 v2; // [rsp+10h] [rbp-110h]<br>  __int64 v3; // [rsp+18h] [rbp-108h]<br>  __int64 v4; // [rsp+20h] [rbp-100h]<br>  __int64 v5; // [rsp+28h] [rbp-F8h]<br>  __int64 v6; // [rsp+30h] [rbp-F0h]<br>  __int64 v7; // [rsp+38h] [rbp-E8h]<br>  __int64 v8; // [rsp+40h] [rbp-E0h]<br>  __int64 v9; // [rsp+48h] [rbp-D8h]<br>  __int64 v10; // [rsp+50h] [rbp-D0h]<br>  __int64 v11; // [rsp+58h] [rbp-C8h]<br>  char v12[13]; // [rsp+60h] [rbp-C0h] BYREF<br>  char v13[4]; // [rsp+6Dh] [rbp-B3h] BYREF<br>  char v14[19]; // [rsp+71h] [rbp-AFh] BYREF<br>  char v15[32]; // [rsp+90h] [rbp-90h] BYREF<br>  int v16; // [rsp+B0h] [rbp-70h]<br>  char v17; // [rsp+B4h] [rbp-6Ch]<br>  char v18[72]; // [rsp+C0h] [rbp-60h] BYREF<br>  unsigned __int64 v19; // [rsp+108h] [rbp-18h]<br><br>  v19 = __readfsqword(0x28u);<br>  qmemcpy(v12, &quot;Iodl&gt;Qnb(ocy&quot;, 12);<br>  v12[12] = 127;<br>  qmemcpy(v13, &quot;y.i&quot;, 3);<br>  v13[3] = 127;<br>  qmemcpy(v14, &quot;d`3w&#125;wek9&#123;iy=~yL@EC&quot;, sizeof(v14));<br>  memset(v15, 0, sizeof(v15));<br>  v16 = 0;<br>  v17 = 0;<br>  sub_4406E0(0LL, v15, 37LL);<br>  v17 = 0;<br>  if ( sub_424BA0(v15) == 36 )<br>  &#123;<br>    for ( i = 0; i &lt; (unsigned __int64)sub_424BA0(v15); ++i )<br>    &#123;<br>      if ( (unsigned __int8)(v15[i] ^ i) != v12[i] )<br>      &#123;<br>        result = 4294967294LL;<br>        goto LABEL_13;<br>      &#125;<br>    &#125;<br>    sub_410CC0(&quot;continue!&quot;);<br>    memset(v18, 0, 0x40uLL);<br>    v18[64] = 0;<br>    sub_4406E0(0LL, v18, 64LL);<br>    v18[39] = 0;<br>    if ( sub_424BA0(v18) == 39 )<br>    &#123;<br>      v2 = sub_400E44(v18);<br>      v3 = sub_400E44(v2);<br>      v4 = sub_400E44(v3);<br>      v5 = sub_400E44(v4);<br>      v6 = sub_400E44(v5);<br>      v7 = sub_400E44(v6);<br>      v8 = sub_400E44(v7);<br>      v9 = sub_400E44(v8);<br>      v10 = sub_400E44(v9);<br>      v11 = sub_400E44(v10);<br>      if ( !(unsigned int)sub_400360(v11, off_6CC090) )<br>      &#123;<br>        sub_410CC0(&quot;You found me!!!&quot;);<br>        sub_410CC0(&quot;bye bye~&quot;);<br>      &#125;<br>      result = 0LL;<br>    &#125;<br>    else<br>    &#123;<br>      result = 4294967293LL;<br>    &#125;<br>  &#125;<br>  else<br>  &#123;<br>    result = 0xFFFFFFFFLL;<br>  &#125;<br>LABEL_13:<br>  if ( __readfsqword(0x28u) != v19 )<br>    sub_444020();<br>  return result;<br>&#125;<br></code></pre></td></tr></table></figure>

<p class='item-img' data-src='blob:https://tokameine.top/b1431af4-80d7-4679-b8c5-5b5d917fc822'><img src="blob:https://tokameine.top/b1431af4-80d7-4679-b8c5-5b5d917fc822"></p>
<p>     通过分析，我们可以把函数名修正为：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">  v19 = __readfsqword(0x28u);<br>  qmemcpy(v12, &quot;Iodl&gt;Qnb(ocy&quot;, 12);<br>  v12[12] = 127;<br>  qmemcpy(v13, &quot;y.i&quot;, 3);<br>  v13[3] = 127;<br>  qmemcpy(v14, &quot;d`3w&#125;wek9&#123;iy=~yL@EC&quot;, sizeof(v14));<br>  memset(v15, 0, sizeof(v15));<br>  v16 = 0;<br>  v17 = 0;<br>  read(0LL, v15, 37LL);<br>  v17 = 0;<br>  if ( strlen(v15) == 36 )<br>  &#123;<br>    for ( i = 0; i &lt; strlen(v15); ++i )<br>    &#123;<br>      if ( (v15[i] ^ i) != v12[i] )<br>      &#123;<br>        result = 4294967294LL;<br>        goto LABEL_13;<br>      &#125;<br>    &#125;<br>    printf(&quot;continue!&quot;);<br>    memset(v18, 0, 0x40uLL);<br>    v18[64] = 0;<br>    read(0LL, v18, 64LL);<br>    v18[39] = 0;<br>    if ( strlen(v18) == 39 )<br>    &#123;<br>      v2 = base64encode(v18);<br>      v3 = base64encode(v2);<br>      v4 = base64encode(v3);<br>      v5 = base64encode(v4);<br>      v6 = base64encode(v5);<br>      v7 = base64encode(v6);<br>      v8 = base64encode(v7);<br>      v9 = base64encode(v8);<br>      v10 = base64encode(v9);<br>      v11 = base64encode(v10);<br>      if ( !sub_400360(v11, off_6CC090) )<br>      &#123;<br>        printf(&quot;You found me!!!&quot;);<br>        printf(&quot;bye bye~&quot;);<br>      &#125;<br>      result = 0LL;<br>    &#125;<br>    else<br>    &#123;<br>      result = 4294967293LL;<br>    &#125;<br>  &#125;<br>  else<br>  &#123;<br>    result = 0xFFFFFFFFLL;<br>  &#125;<br>LABEL_13:<br>  if ( __readfsqword(0x28u) != v19 )<br>    sub_444020();<br>  return result;<br>&#125;<br></code></pre></td></tr></table></figure>

<p class='item-img' data-src='blob:https://tokameine.top/359b4b87-4700-4b72-8f73-7c70985ff7e5'><img src="blob:https://tokameine.top/359b4b87-4700-4b72-8f73-7c70985ff7e5"></p>
<p>    有一处9层base64加密的字符串存在</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">.rodata:00000000004A23A8 aVm0wd2vhuxhtwg db &#x27;Vm0wd2VHUXhTWGhpUm1SWVYwZDRWVll3Wkc5WFJsbDNXa1pPVlUxV2NIcFhhMk0xV&#x27;<br>.rodata:00000000004A23A8                                         ; DATA XREF: .data:off_6CC090↓o<br>.rodata:00000000004A23A8                 db &#x27;mpKS1NHVkdXbFpOYmtKVVZtcEtTMUl5VGtsaVJtUk9ZV3hhZVZadGVHdFRNVTVYVW&#x27;<br>.rodata:00000000004A23A8                 db &#x27;01T2FGSnRVbGhhVjNoaFZWWmtWMXBFVWxSTmJFcElWbTAxVDJGV1NuTlhia0pXWWx&#x27;<br>.rodata:00000000004A23A8                 db &#x27;ob1dGUnJXbXRXTVZaeVdrWm9hVlpyV1hwV1IzaGhXVmRHVjFOdVVsWmlhMHBZV1ZS&#x27;<br>.rodata:00000000004A23A8                 db &#x27;R1lWZEdVbFZTYlhSWFRWWndNRlZ0TVc5VWJGcFZWbXR3VjJKSFVYZFdha1pXWlZaT&#x27;<br>.rodata:00000000004A23A8                 db &#x27;2NtRkhhRk5pVjJoWVYxZDBhMVV3TlhOalJscFlZbGhTY1ZsclduZGxiR1J5VmxSR1&#x27;<br>.rodata:00000000004A23A8                 db &#x27;ZXSlZjRWhaTUZKaFZqSktWVkZZYUZkV1JWcFlWV3BHYTFkWFRrZFRiV3hvVFVoQ1d&#x27;<br>.rodata:00000000004A23A8                 db &#x27;sWXhaRFJpTWtsM1RVaG9hbEpYYUhOVmJUVkRZekZhY1ZKcmRGTk5Wa3A2VjJ0U1Ex&#x27;<br>.rodata:00000000004A23A8                 db &#x27;WlhTbFpqUldoYVRVWndkbFpxUmtwbGJVWklZVVprYUdFeGNHOVhXSEJIWkRGS2RGS&#x27;<br>.rodata:00000000004A23A8                 db &#x27;nJhR2hTYXpWdlZGVm9RMlJzV25STldHUlZUVlpXTlZadE5VOVdiVXBJVld4c1dtSl&#x27;<br>.rodata:00000000004A23A8                 db &#x27;lUWGhXTUZwell6RmFkRkpzVWxOaVNFSktWa1phVTFFeFduUlRhMlJxVWxad1YxWnR&#x27;<br>.rodata:00000000004A23A8                 db &#x27;lRXRXTVZaSFVsUnNVVlZVTURrPQ==&#x27;,0<br></code></pre></td></tr></table></figure>

<p class='item-img' data-src='blob:https://tokameine.top/4d4b878c-f00f-4c54-b9a1-813832011664'><img src="blob:https://tokameine.top/4d4b878c-f00f-4c54-b9a1-813832011664"></p>
<p>    解码后得到：</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://bbs.pediy.com/thread-254172.htm">“https://bbs.pediy.com/thread-254172.htm</a>”</p>
</blockquote>
<p>    看来没有那么简单</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">qmemcpy(v12, &quot;Iodl&gt;Qnb(ocy&quot;, 12);<br>v12[12] = 127;<br>qmemcpy(v13, &quot;y.i&quot;, 3);<br>v13[3] = 127;<br>qmemcpy(v14, &quot;d`3w&#125;wek9&#123;iy=~yL@EC&quot;, sizeof(v14));<br></code></pre></td></tr></table></figure>

<p class='item-img' data-src='blob:https://tokameine.top/1e5c6614-9bbd-4ae7-8aa5-131ff99a1fd0'><img src="blob:https://tokameine.top/1e5c6614-9bbd-4ae7-8aa5-131ff99a1fd0"></p>
<p>    这里还有一个显然特殊的字符串</p>
<p>    v12、v13、v14在内存中是连续的，通过第二和第四行的赋值操作将‘\0’抹去，使得他们连成一整个字符串(但本来是‘\0’的地方现在被填充了，所以字符串增加了两个字节)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">BYTE ke1[14] = &quot;Iodl&gt;Qnb(ocy&quot;;<br>char ke2[5] = &quot;y.i&quot;;<br>char ke3[20] = &quot;d`3w&#125;wek9&#123;iy=~yL@EC&quot;;<br>for (int i = 0; i &lt; 13; i++)<br>&#123;<br>ke1[i] ^= i;<br>if (i == 12)<br>ke1[12] = 127 ^ i;<br>&#125;<br>cout &lt;&lt; ke1;<br>for (int i = 0; i &lt; 4; i++)<br>&#123;<br>ke2[i] ^= (i + 13);<br>if (i == 3)<br>&#123;<br>ke2[3] = 127 ^ (i + 13);<br>&#125;<br>&#125;<br>cout &lt;&lt; ke2;<br>for (int i = 0; i &lt; 19; i++)<br>&#123;<br>ke3[i] ^= (i + 17);<br>&#125;<br>cout &lt;&lt; ke3;<br></code></pre></td></tr></table></figure>

<p class='item-img' data-src='blob:https://tokameine.top/b822df0d-854a-48a6-ab73-baa627bfea64'><img src="blob:https://tokameine.top/b822df0d-854a-48a6-ab73-baa627bfea64"></p>
<p>解密之后得到：</p>
<blockquote>
<p>Info:The first four chars are `flag`</p>
</blockquote>
<p>    现在暂时无法理解它的意义，好像什么都没说一样，但实际上是个必要的提示</p>
<p>     自以上分析，sub_4009C6函数似乎已经没有其他信息可以获取了</p>
<p class='item-img' data-src='https://img-blog.csdnimg.cn/20210624174339695.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L1Rva2FtZWluZQ==,size_16,color_FFFFFF,t_70'><img src="https://img-blog.csdnimg.cn/20210624174339695.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L1Rva2FtZWluZQ==,size_16,color_FFFFFF,t_70">​<img src="blob:https://tokameine.top/aa073735-1f60-4eec-9ac6-dc037eb63785"></p>
<p>    这个体量的函数列表显然也不太能够一个个去检查 </p>
<p>    再次从字符串搜索入手：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">.data:00000000006CC090 off_6CC090      dq offset aVm0wd2vhuxhtwg<br>.data:00000000006CC090                                         ; DATA XREF: sub_4009C6+31B↑r<br>.data:00000000006CC090                                         ; &quot;Vm0wd2VHUXhTWGhpUm1SWVYwZDRWVll3Wkc5WFJ&quot;...<br>.data:00000000006CC098                 align 20h<br>.data:00000000006CC0A0 ; char byte_6CC0A0[3]<br>.data:00000000006CC0A0 byte_6CC0A0     db 40h, 35h, 20h, 56h, 5Dh, 18h, 22h, 45h, 17h, 2Fh, 24h<br>.data:00000000006CC0A0                                         ; DATA XREF: sub_400D35+95↑r<br>.data:00000000006CC0A0                                         ; sub_400D35+C1↑r ...<br>.data:00000000006CC0A0                 db 6Eh, 62h, 3Ch, 27h, 54h, 48h, 6Ch, 24h, 6Eh, 72h, 3Ch<br>.data:00000000006CC0A0                 db 32h, 45h, 5Bh<br></code></pre></td></tr></table></figure>

<p class='item-img' data-src='blob:https://tokameine.top/9bd43ef3-0b2b-4e0c-896a-f8c4c0b53616'><img src="blob:https://tokameine.top/9bd43ef3-0b2b-4e0c-896a-f8c4c0b53616"></p>
<p>     从那个9层base64的字符串向上查找，来到此处，发现在下面还有一个特殊的数组(没做成数组之前很是明显，我将它们打成组了)</p>
<p class='item-img' data-src='https://img-blog.csdnimg.cn/20210624175133569.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L1Rva2FtZWluZQ==,size_16,color_FFFFFF,t_70'><img src="https://img-blog.csdnimg.cn/20210624175133569.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L1Rva2FtZWluZQ==,size_16,color_FFFFFF,t_70">​<img src="blob:https://tokameine.top/179bbcbb-ade6-4806-89a1-2f230d428891"></p>
<p>     这个函数通过sub_402080，也就是init函数中的函数数组来初始化</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">unsigned __int64 sub_400D35()<br>&#123;<br>  unsigned __int64 result; // rax<br>  unsigned int v1; // [rsp+Ch] [rbp-24h]<br>  int i; // [rsp+10h] [rbp-20h]<br>  int j; // [rsp+14h] [rbp-1Ch]<br>  unsigned int v4; // [rsp+24h] [rbp-Ch]<br>  unsigned __int64 v5; // [rsp+28h] [rbp-8h]<br><br>  v5 = __readfsqword(050u);<br>  v1 = sub_43FD20(0LL) - qword_6CEE38;<br>  for ( i = 0; i &lt;= 1233; ++i )<br>  &#123;<br>    sub_40F790(v1);<br>    sub_40FE60();<br>    sub_40FE60();<br>    v1 = sub_40FE60() ^ 0x98765432;<br>  &#125;<br>  v4 = v1;<br>  if ( ((unsigned __int8)v1 ^ byte_6CC0A0[0]) == 0x66 &amp;&amp; (HIBYTE(v4) ^ byte_6CC0A0[3]) == 0x67 )<br>  &#123;<br>    for ( j = 0; j &lt;= 24; ++j )<br>      sub_410E90(byte_6CC0A0[j] ^ *((_BYTE *)&amp;v4 + j % 4));<br>  &#125;<br>  result = __readfsqword(0x28u) ^ v5;<br>  if ( result )<br>    sub_444020();<br>  return result;<br>&#125;<br></code></pre></td></tr></table></figure>

<p class='item-img' data-src='blob:https://tokameine.top/f3d98fe8-bdaa-46c1-9fde-ec819fe50f2d'><img src="blob:https://tokameine.top/f3d98fe8-bdaa-46c1-9fde-ec819fe50f2d"></p>
<p>    第一个for循环对v1变量进行初始化，得到一个定值；</p>
<p>    第二个for循环中将上述的特殊数组做循环一次异或；</p>
<p>    至于sub_410E90、sub_40F790、sub_40FE60函数则由于过于复杂，或许是系统函数，便不做分析，选择性忽视过去</p>
<p>    同时，第二个for循环中的异或数是 v4的某个BYTE位，而v4是一个int类型的4BYTE数据</p>
<p>    那么我们现在需要做的应该是获取这个v4或v1</p>
<p>    在if条件中，我们可以发现：</p>
<p>    v1的第一个BYTE与byte_6CC0A0[0]异或结果位‘f’；</p>
<p>    v4的最后一个BYTE与byte_6CC0A0[3]异或结果位‘g’</p>
<p>    根据：</p>
<blockquote>
<p>Info:The first four chars are `flag`</p>
</blockquote>
<p>   可以猜测v1的四个BYTE与byte_6CC0A0的前四个异或后结果应该分别位‘f’、’l’、‘a’、‘g’</p>
<p>    以此获得v1之后再做第二个for循环运算得到结果：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">char k[] = &#123; 0x40, 0x35, 0x20, 0x56, 0x5D, 0x18, 0x22, 0x45, 0x17, 0x2F, 0x24,0x6E, 0x62, 0x3C, 0x27, 0x54, 0x48, 0x6C, 0x24, 0x6E, 0x72, 0x3C,0x32, 0x45, 0x5B &#125;;<br><br>BYTE f[4];<br>f[0] = 0x66 ^ k[0];<br>f[1] = 108 ^ k[1];<br>f[2] = 97 ^ k[2];<br>f[3] = 0x67 ^ k[3];<br>for (int i = 0; i &lt;= 24; i++)<br>&#123;<br>k[i] ^= f[i % 4];<br>&#125;<br>for (int i = 0; i &lt;= 24; i++)<br>&#123;<br>cout &lt;&lt; (char)k[i];<br>&#125;<br></code></pre></td></tr></table></figure>

<p>    从此得到flag</p>
<p>    这次我该吸取的教训是：不要因为事情看起来复杂就认为考点不在这里 ​</p>
<p>插画ID : 90097136</p>
<div id="paginator"></div></div><div id="post-footer"><div id="pages"><div class="footer-link" style="width: 50%;text-align:right;border-right:1px #fe2 solid"><a href="/2021/07/01/buuctfjocker/">← Next BUUCTF - 网鼎杯 2020 青龙组 - jocker 分析与记录</a></div><div class="footer-link" style="width: 50%;right:1px;border-left:1px #fe2 solid"><a href="/2021/06/23/zer0pts2020easy/">Zer0pts2020 - easy strcmp 分析与加法 Prev →</a></div></div></div></div><div class="bottom-btn"><div><a class="i-top" id="to-top" onClick="scrolls.scrolltop();" title="To Top" style="opacity: 0; display: none;">∧ </a><a class="i-color" id="color-mode" onClick="colorMode.change()" title="Change Theme"></a></div></div></article><aside><div id="about"><a href="/" id="logo"><img src="/img/faction/6.png" alt="Logo"></a><h1 id="Dr"><a href="TokameinE">TokameinE</a></h1><div id="description"><p></p></div><div id="social-links"><a class="social" target="_blank" rel="noopener" href="https://github.com/ErodedElk"><i class="fab fa-github" alt="GitHub"></i></a><a class="social" target="_blank" rel="noopener" href="https://space.bilibili.com/1782544616"><i class="fa-brands fa-bilibili" alt="BiliBili"></i></a></div></div><div id="aside-block"></div><footer><nobr>Published with <a target="_blank" rel="noopener" href="http://hexo.io">Hexo</a></nobr><wbr><nobr> Theme <a target="_blank" rel="noopener" href="https://github.com/Yue-plus/hexo-theme-arknights">Arknights</a></nobr><wbr><nobr> by <a target="_blank" rel="noopener" href="https://github.com/Yue-plus">Yue_plus</a></nobr></footer></aside></main><canvas id="canvas-dust"></canvas><script src="/js/search.js"></script><script src="/js/arknights.js"></script><script src="//unpkg.com/lightgallery@2.7.1/lightgallery.min.js"></script><script src="//unpkg.com/lightgallery@2.7.1/plugins/zoom/lg-zoom.min.js"></script><script src="//unpkg.com/lightgallery@2.7.1/plugins/thumbnail/lg-thumbnail.min.js"></script><script src="/js/pjax.js"></script><script class="pjax-js">reset= () => {document.querySelector('.lg-container')?.remove()
lightGallery(document.getElementById('post-bg'), {
  plugins: [lgZoom,lgThumbnail],
  selector: '.item-img'})}</script><script>window.addEventListener("load",() => {pjax = new Pjax({
 cacheBust: false,
 selectors: ['title','article','#aside-block','.pjax-js'],
 switches: {'article': Pjax.switches.sideBySide},
 switchesOptions: {
   'article': {
     classNames: {
       remove: "pjax-out",
       add: "pjax-in"
     }
   }
 }
});
document.addEventListener("pjax:complete", reset);reset()})</script></body></html>